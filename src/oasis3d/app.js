!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):"object"==typeof exports?exports.oasis3d=t(require("three")):e.oasis3d=t(e.three)}(window,function(e){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=20)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(14),o=i(4),r=i(3),l=9991439;class a{static pointDistanceFromLine(e,t,i,n,s,o){let r=a.closestPointOnLine(e,t,i,n,s,o),l=e-r.x,h=t-r.y;return Math.sqrt(l*l+h*h)}static closestPointOnLine(e,t,i,n,s,o){let r,l,a=s-i,h=o-n,c=((e-i)*a+(t-n)*h)/(a*a+h*h);return c<0||i===s&&n===o?(r=i,l=n):c>1?(r=s,l=o):(r=i+c*a,l=n+c*h),{x:r,y:l}}static distance(e,t,i,n){return Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2))}static angle(e,t,i,n){let s=e*i+t*n,o=e*n-t*i;return-Math.atan2(o,s)}static angle2pi(e,t,i,n){let s=a.angle(e,t,i,n);return s<0&&(s+=2*Math.PI),s}static isClockwise(e){let t=Math.min(0,Math.min.apply(null,a.map(e,function(e){return e.x}))),i=Math.min(0,Math.min.apply(null,a.map(e,function(e){return e.x}))),n=a.map(e,function(e){return{x:e.x-t,y:e.y-i}}),s=0;for(let e=0;e<n.length;e++){let t,i=n[e];s+=((t=e===n.length-1?n[0]:n[e+1]).x-i.x)*(t.y+i.y)}return s>=0}static guid(){let e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}static polygonPolygonIntersect(e,t){for(let i=0;i<e.length;i++){let n,s=e[i];if(n=i===e.length-1?e[0]:e[i+1],a.linePolygonIntersect(s.x,s.y,n.x,n.y,t))return!0}return!1}static linePolygonIntersect(e,t,i,n,s){for(let o=0;o<s.length;o++){let r,l=s[o];if(r=o===s.length-1?s[0]:s[o+1],a.lineLineIntersect(e,t,i,n,l.x,l.y,r.x,r.y))return!0}return!1}static lineLineIntersect(e,t,i,n,s,o,r,l){function a(e,t,i){let n=e.x,s=e.y,o=t.x,r=t.y,l=i.x;return(i.y-s)*(o-n)>(r-s)*(l-n)}let h={x:e,y:t},c={x:i,y:n},d={x:s,y:o},u={x:r,y:l};return a(h,d,u)!==a(c,d,u)&&a(h,c,d)!==a(h,c,u)}static pointInPolygon(e,t,i,n,s){n=n||0,s=s||0;let o=0,r=0;if(void 0===n||void 0===s){for(let e=0;e<i.length;e++)o=Math.min(o,i[e].x),r=Math.min(o,i[e].y);n=o-10,s=r-10}let l=0;for(let o=0;o<i.length;o++){let r,h=i[o];r=o===i.length-1?i[0]:i[o+1],a.lineLineIntersect(n,s,e,t,h.x,h.y,r.x,r.y)&&l++}return l%2==1}static polygonInsidePolygon(e,t,i,n){i=i||0,n=n||0;for(let s=0;s<e.length;s++)if(!a.pointInPolygon(e[s].x,e[s].y,t,i,n))return!1;return!0}static polygonOutsidePolygon(e,t,i,n){i=i||0,n=n||0;for(let s=0;s<e.length;s++)if(a.pointInPolygon(e[s].x,e[s].y,t,i,n))return!1;return!0}static forEach(e,t){for(let i=0;i<e.length;i++)t(e[i])}static forEachIndexed(e,t){for(let i=0;i<e.length;i++)t(i,e[i])}static map(e,t){let i=[];return e.forEach(e=>{i.push(t(e))}),i}static removeIf(e,t){let i=[];return e.forEach(e=>{t(e)||i.push(e)}),i}static cycle(e,t){let i=e.slice(0);for(let e=0;e<t;e++){let e=i.shift();i.push(e)}return i}static unique(e,t){let i=[],n={};for(let s=0;s<e.length;s++)n.hasOwnProperty(e[s])||(i.push(e[s]),n[t(e[s])]=!0);return i}static removeValue(e,t){for(let i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}static hasValue(e,t){for(let i=0;i<e.length;i++)if(e[i]===t)return!0;return!1}static subtract(e,t){return a.removeIf(e,function(e){return a.hasValue(t,e)})}static createPlaneGeometry(e){let t=e.ctype,i=o.default[t].height,s=o.default[t].width,l=o.default[t].length,a=o.default[t].pic,h={map:(new n.TextureLoader).load(r.default.getResourceDir()+a),side:n.FrontSide,depthTest:!0};return{geometry:new n.CubeGeometry(s,i,l,0,0,1),material:new n.MeshLambertMaterial(h)}}static createGeometryAndMaterials(e){let t=e.ctype,i=o.default[t].length,s=o.default[t].height,r=o.default[t].width,a=o.default[t].style,h=new n.CubeGeometry(i,s,r,0,0,1);if("emptyCabinet"!==t){for(let e=0;e<h.faces.length;e+=2){let t=a.skinColor||l;h.faces[e].color.setHex(t),h.faces[e+1].color.setHex(t)}let e={vertexColors:n.FaceColors},t=e,s=e,o=e,c=e,d=e;null!=a&&void 0!==a&&null!=a.skin&&void 0!==a.skin&&(e=this.createSkinOptionOnj(this,i,r,a.skin.skin_up,h,4),t=this.createSkinOptionOnj(this,i,r,a.skin.skin_down,h,6),s=this.createSkinOptionOnj(this,i,r,a.skin.skin_fore,h,0),o=this.createSkinOptionOnj(this,i,r,a.skin.skin_behind,h,2),c=this.createSkinOptionOnj(this,i,r,a.skin.skin_left,h,8),d=this.createSkinOptionOnj(this,i,r,a.skin.skin_right,h,10));let u=[];return u.push(new n.MeshLambertMaterial(s)),u.push(new n.MeshLambertMaterial(o)),u.push(new n.MeshLambertMaterial(e)),u.push(new n.MeshLambertMaterial(t)),u.push(new n.MeshLambertMaterial(d)),u.push(new n.MeshLambertMaterial(c)),{geometry:h,material:u}}return{geometry:h,material:new n.MeshBasicMaterial({visible:!1})}}static getEnvMap(){return(new n.CubeTextureLoader).setPath(r.default.getResourceDir()).load(["room.jpg","room.jpg","room.jpg","room.jpg","room.jpg","room.jpg"])}static createSkinOptionOnj(e,t,i,s,o,r){if(e.hasObj(s)){if(e.hasObj(s.imgurl)){let n=null;return n=e.hasObj(s.envMap)?{map:e.createSkin(t,i,s),transparent:!0,envMap:e.getEnvMap()}:{map:e.createSkin(t,i,s),transparent:!0}}return e.hasObj(s.skinColor)&&(o.faces[r].color.setHex(s.skinColor),o.faces[r+1].color.setHex(s.skinColor)),{vertexColors:n.FaceColors}}return{vertexColors:n.FaceColors}}static hasObj(e){return null!=e&&void 0!==e}static createSkin(e,t,i){let s=128,o=128;null!=i.width&&void 0!==i.width&&(s=i.width),null!=i.height&&void 0!==i.height&&(o=i.height);let l=(new n.TextureLoader).load(r.default.getResourceDir()+i.imgurl),a=!1;return null!=i.repeatx&&void 0!==i.repeatx&&!0===i.repeatx&&(l.wrapS=n.RepeatWrapping,a=!0),null!=i.repeaty&&void 0!==i.repeaty&&!0===i.repeaty&&(l.wrapT=n.RepeatWrapping,a=!0),a&&l.repeat.set(e/o,t/o),l}static createCube(e){let t=e.length||1e3,i=e.width||t,s=e.height||10,o=e.x||0,r=e.y||0,l=e.z||0,a=e.style.skinColor||9991439,h=new n.CubeGeometry(t,s,i,0,0,1);for(let e=0;e<h.faces.length;e+=2){let t=a||5445700*Math.random();h.faces[e].color.setHex(t),h.faces[e+1].color.setHex(t)}let c={vertexColors:n.FaceColors},d=c,u=c,f=c,p=c,m=c,g=1;null!=e.style&&void 0!==e.style&&null!=e.style.skin&&void 0!==e.style.skin&&(null!=e.style.skin.opacity&&void 0!==e.style.skin.opacity&&(g=e.style.skin.opacity),c=this.createSkinOptionOnj(this,t,i,e.style.skin.skin_up,h,4),d=this.createSkinOptionOnj(this,t,i,e.style.skin.skin_down,h,6),u=this.createSkinOptionOnj(this,t,i,e.style.skin.skin_fore,h,0),f=this.createSkinOptionOnj(this,t,i,e.style.skin.skin_behind,h,2),p=this.createSkinOptionOnj(this,t,i,e.style.skin.skin_left,h,8),m=this.createSkinOptionOnj(this,t,i,e.style.skin.skin_right,h,10));let y=[];y.push(new n.MeshPhongMaterial(u)),y.push(new n.MeshPhongMaterial(f)),y.push(new n.MeshPhongMaterial(c)),y.push(new n.MeshPhongMaterial(d)),y.push(new n.MeshPhongMaterial(m)),y.push(new n.MeshPhongMaterial(p));let w=y,x=new n.Mesh(h,w);return x.castShadow=!0,x.receiveShadow=!0,x.name=e.name,x.position.set(o,r,l),x}static mergeModel(e,t,i){let o=new s.default(t),r=new s.default(i),l=null;if("-"===e)l=o.subtract(r);else{if("+"===e){new n.Mesh(i);return i.updateMatrix(),t.geometry.merge(i.geometry,i.matrix),t}if("&"!==e)return t;l=o.intersect(r)}let a=[];for(let e=0;e<1;e++)a.push(new n.MeshLambertMaterial({vertexColors:n.FaceColors}));let h=a,c=l.toMesh(h);return c.castShadow=!0,c.receiveShadow=!0,c}static createHole(e){let t=null,i=e.ctype,s=o.default[i];t=a.createCube(s);let r={length:s.length,width:s.width,height:s.height-5,style:{}},l=a.createCube(r);t=a.mergeModel("-",t,l);let h=new n.MeshLambertMaterial({color:14540253});return{geometry:t.geometry,material:h}}static createCamera(e){let t=e.ctype,i=o.default[t].length,s=o.default[t].height,r=o.default[t].width;o.default[t].style;return{geometry:new n.CubeGeometry(i,s,r,0,0,1),material:new n.MeshBasicMaterial({visible:!1})}}static setSkinColor(e,t){if(a.hasObj(e.material.emissive))e.material.emissive.setHex(t);else if(a.hasObj(e.material.materials))e.material.materials.length>0&&e.material.materials.forEach(function(e,i){e.emissive.setHex(t)});else if(e.material.length>0)e.material.forEach(function(e,i){e.emissive.setHex(t)});else if(a.hasObj(e.children)){e.children[0].material.forEach(function(e,i){e.emissive.setHex(t)})}}static getElementPosition(e){let t=0,i=0;for(;null!=e;)t+=e.offsetLeft,i+=e.offsetTop,e=e.offsetParent;return{left:t,top:i}}static generateUUID(){return n.Math.generateUUID()}}a.createPlaneGeometryObj=function(e){let t=e,i=new n.TextureLoader;i.setCrossOrigin(this.crossOrigin);let s=i.load(r.default.getResourceDir()+t.pic);s.minFilter=n.LinearFilter;let o={map:s,overdraw:.5,side:n.FrontSide,blending:n.AdditiveBlending,transparent:t.transparent,needsUpdate:!0,premultipliedAlpha:!0,opacity:t.opacity},l=new n.Mesh(new n.PlaneGeometry(t.width,t.height,1,1),new n.MeshLambertMaterial(o));return l.rotation.x=t.rotation.x,l.rotation.y=t.rotation.y,l.rotation.z=t.rotation.z,l},t.default=a},function(t,i){t.exports=e},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=/[^\x20\t\r\n\f]+/g;t.default=function(e){e="string"==typeof e?function(e){let t={};return(e.match(n)||[]).forEach(function(e,i){t[e]=!0}),t}(e):Object.assign({},e);let t,i,s,o,r=[],l=[],a=-1,h=function(){for(o=o||e.once,s=t=!0;l.length;a=-1)for(i=l.shift();++a<r.length;)!1===r[a].apply(i[0],i[1])&&e.stopOnFalse&&(a=r.length,i=!1);e.memory||(i=!1),t=!1,o&&(r=i?[]:"")},c={add(...n){return r&&(i&&!t&&(a=r.length-1,l.push(i)),function t(i){i.forEach(function(i,n){"function"==typeof i?e.unique&&c.has(i)||r.push(i):i&&i.length&&"string"!=typeof i&&t(i)})}(n),i&&!t&&h()),this},remove(...e){return e.forEach(function(e,t){function i(t){return t===e}for(;r.findIndex(i)>-1;){let e=r.findIndex(i);r.splice(e,1),e<=a&&a--}}),this},has:e=>e?r.findIndex(function(t){return t===e})>-1:r.length>0,empty(){return r&&(r=[]),this},disable(){return o=l=[],r=i="",this},disabled:()=>!r,lock(){return o=l=[],i||t||(r=i=""),this},locked:()=>!!o,fireWith(e,i){return o||(i=[e,(i=i||[]).slice?i.slice():i],l.push(i),t||h()),this},fire(...e){return c.fireWith(this,arguments),this},fired:()=>!!s};return c}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=new class{constructor(){this.roomTextureDir="static/rooms/textures/",this.resourceDir="static/res/"}setRoomTextureDir(e){this.roomTextureDir=e}setResourceDir(e){this.resourceDir=e}getResourceDir(){return this.resourceDir}getDefaultRoomTexture(){return{url:this.roomTextureDir+"hardwood.png",scale:400}}getDefaultWallTexture(){return{url:this.roomTextureDir+"wallmap.png",stretch:!0,scale:0}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={aircondition:{length:60,width:80,height:220,style:{skinColor:16711422,skin:{skin_fore:{imgurl:"aircondition.jpg"}}}},camera:{width:2,height:6,length:6,style:{}},messagePanel:{width:100,height:160,length:2,pic:"message.jpg"},television:{length:180,width:10,height:120,style:{skinColor:5592405,skin:{skin_right:{imgurl:"tv.jpg"}}}},doorControl:{length:40,width:10,height:40,style:{skinColor:3355443,skin:{skin_left:{imgurl:"doorControl.jpg"}}}},glasses:{length:180,width:10,height:120,style:{}},glassDoor:{length:208,width:10,height:215,style:{}},emptyCabinet:{length:66,width:70,height:200,thick:2,doors:{doorType:"lr",doorSize:[1],doorname:["cabinet1_1_door_01"],skins:[{skinColor:3355443,skin_fore:{imgurl:"rack_door_back.jpg"},skin_behind:{imgurl:"rack_front_door.jpg"}}]},style:{skin:{skinColor:16711680,skin_up:{skin:{skinColor:16711680,skin_up:{imgurl:"rack_door_back.jpg"},skin_down:{imgurl:"rack_door_back.jpg"},skin_fore:{skinColor:16711680,imgurl:"rack_door_back.jpg"},skin_behind:{skinColor:16711680,imgurl:"rack_door_back.jpg"},skin_left:{imgurl:"rack_door_back.jpg"},skin_right:{imgurl:"rack_door_back.jpg"}}},skin_down:{skin:{skinColor:3355443}},skin_left:{skin:{skinColor:3355443}},skin_right:{skin:{skinColor:3355443}},skin_behind:{skin:{skinColor:3355443}}}}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0);t.default=class extends n.Mesh{constructor(e,t,i,s,o,r,l){super(r,l),this.fixed=!1,this.hover=!1,this.selected=!1,this.highlighted=!1,this.emissiveColor=4473924,this.obstructFloorMoves=!0,this.allowRotate=!0,this.allowYDrag=!1,this.error=!1,this.errorColor=16711680,this.errorGlow=new n.Mesh,this.dragOffset=new n.Vector3,this.initObject=function(){this.placeInRoom(),this.scene.needsUpdate=!0},this.model=e,this.metadata=t,this.materials=l,this.scene=this.model.scene,this.errorColor=16711680,this.resizable=t.resizable,this.castShadow=!0,i?(this.position.copy(i),this.position_set=!0):this.position_set=!1,this.geometry.computeBoundingBox(),this.geometry.applyMatrix((new n.Matrix4).makeTranslation(-.5*(this.geometry.boundingBox.max.x+this.geometry.boundingBox.min.x),-.5*(this.geometry.boundingBox.max.y+this.geometry.boundingBox.min.y),-.5*(this.geometry.boundingBox.max.z+this.geometry.boundingBox.min.z))),this.geometry.computeBoundingBox(),this.halfSize=this.objectHalfSize(),s&&(this.rotation.y=s),null!=o&&this.setScale(o.x,o.y,o.z),this.obstructFloorMoves=!1,this.receiveShadow=!0}removeSelf(){this.scene.removeItem(this)}removed(){return null}resize(e,t,i){let n=t/this.getWidth(),s=e/this.getHeight(),o=i/this.getDepth();this.setScale(n,s,o)}setScale(e,t,i){let s=new n.Vector3(e,t,i);this.halfSize.multiply(s),s.multiply(this.scale),this.scale.set(s.x,s.y,s.z),this.resized(),this.scene.needsUpdate=!0}setFixed(e){this.fixed=e}getHeight(){return 2*this.halfSize.y}getWidth(){return 2*this.halfSize.x}getDepth(){return 2*this.halfSize.z}updateHighlight(){let e=this.hover||this.selected;this.highlighted=e;let t=e?this.emissiveColor:0;if(this.materials instanceof Array)for(let e=0;e<this.materials.length;e++)this.materials[e].emissive.setHex(t);else this.materials.emissive.setHex(t)}mouseOver(){this.hover=!0,this.updateHighlight()}mouseOff(){this.hover=!1,this.updateHighlight()}setSelected(){this.selected=!0,this.updateHighlight()}setUnselected(){this.selected=!1,this.updateHighlight()}clickPressed(e){this.dragOffset.copy(e.point).sub(this.position)}clickDragged(e,t){e&&this.moveToPosition(e.point.sub(this.dragOffset),e,t)}rotate(e){if(e){let t=s.default.angle(0,1,e.point.x-this.position.x,e.point.z-this.position.z),i=Math.PI/16;for(let e=-4;e<=4;e++)if(Math.abs(t-e*(Math.PI/2))<i){t=e*(Math.PI/2);break}this.rotation.y=t}}clickReleased(){this.error&&this.hideError()}customIntersectionPlanes(){return[]}getCorners(e,t,i){i=i||this.position;let s=this.halfSize.clone(),o=new n.Vector3(-s.x,0,-s.z),r=new n.Vector3(s.x,0,-s.z),l=new n.Vector3(s.x,0,s.z),a=new n.Vector3(-s.x,0,s.z),h=new n.Matrix4;return h.makeRotationY(this.rotation.y),o.applyMatrix4(h),r.applyMatrix4(h),l.applyMatrix4(h),a.applyMatrix4(h),o.add(i),r.add(i),l.add(i),a.add(i),[{x:o.x,y:o.z},{x:r.x,y:r.z},{x:l.x,y:l.z},{x:a.x,y:a.z}]}showError(e){e=e||this.position,this.error||(this.error=!0,this.errorGlow=this.createGlow(this.errorColor,.8,!0),this.scene.add(this.errorGlow)),this.errorGlow.position.copy(e)}hideError(){this.error&&(this.error=!1,this.scene.remove(this.errorGlow))}createGlow(e,t,i){i=i||!1,t=t||.2;let s=new n.MeshBasicMaterial({color:e,blending:n.AdditiveBlending,opacity:.2,transparent:!0,depthTest:!i}),o=new n.Mesh(this.geometry.clone(),s);return o.position.copy(this.position),o.rotation.copy(this.rotation),o.scale.copy(this.scale),o}moveToPosition(e,t,i){this.position.copy(e)}objectHalfSize(){let e=new n.Box3;return e.setFromObject(this),e.max.clone().sub(e.min).divideScalar(2)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0),o=i(5);t.default=class extends o.default{constructor(e,t,i,s,o,r,l){super(e,t,i,s,o,r,l),this.addToWall=!1,this.boundToFloor=!1,this.currentWallEdge=null,this.refVec=new n.Vector2(0,1),this.wallOffsetScalar=0,this.sizeX=0,this.sizeY=0,this.allowRotate=!1}closestWallEdge(){let e=this.model.floorplan.wallEdges(),t=null,i=null,n=this.position.x,s=this.position.z;return e.forEach(e=>{let o=e.distanceTo(n,s);(null===i||o<i)&&(i=o,t=e)}),t}removed(){null!=this.currentWallEdge&&this.addToWall&&(s.default.removeValue(this.currentWallEdge.wall.items,this),this.redrawWall())}resized(){this.boundToFloor&&(this.position.y=.5*(this.geometry.boundingBox.max.y-this.geometry.boundingBox.min.y)*this.scale.y+.01),this.updateSize(),this.redrawWall()}placeInRoom(){let e=this.closestWallEdge();if(this.changeWallEdge(e),this.updateSize(),!this.position_set){let t=e.interiorCenter(),i=new n.Vector3(t.x,e.wall.height/2,t.y);this.boundMove(i),this.position.copy(i),this.redrawWall()}}moveToPosition(e,t,i){this.changeWallEdge(t.object.edge),this.boundMove(e),this.position.copy(e),this.redrawWall()}customIntersectionPlanes(){return this.model.floorplan.wallEdgePlanes()}isValidPosition(e){return!0}updateSize(){this.wallOffsetScalar=(this.geometry.boundingBox.max.z-this.geometry.boundingBox.min.z)*this.scale.z/2,this.sizeX=(this.geometry.boundingBox.max.x-this.geometry.boundingBox.min.x)*this.scale.x,this.sizeY=(this.geometry.boundingBox.max.y-this.geometry.boundingBox.min.y)*this.scale.y}getWallOffset(){return this.wallOffsetScalar}changeWallEdge(e){null!=this.currentWallEdge&&(this.addToWall?(s.default.removeValue(this.currentWallEdge.wall.items,this),this.redrawWall()):s.default.removeValue(this.currentWallEdge.wall.onItems,this)),null!=this.currentWallEdge&&this.currentWallEdge.wall.dontFireOnDelete(this.remove.bind(this)),e.wall.fireOnDelete(this.remove.bind(this));let t=new n.Vector2,i=e.plane.geometry.faces[0].normal;t.x=i.x,t.y=i.z;let o=s.default.angle(this.refVec.x,this.refVec.y,t.x,t.y);this.rotation.y=o,this.currentWallEdge=e,this.addToWall?(e.wall.items.push(this),this.redrawWall()):e.wall.onItems.push(this)}redrawWall(){this.addToWall&&this.currentWallEdge.wall.fireRedraw()}boundMove(e){let t=this.currentWallEdge;e.applyMatrix4(t.interiorTransform),e.x<this.sizeX/2+1?e.x=this.sizeX/2+1:e.x>t.interiorDistance()-this.sizeX/2-1&&(e.x=t.interiorDistance()-this.sizeX/2-1),this.boundToFloor?e.y=.5*(this.geometry.boundingBox.max.y-this.geometry.boundingBox.min.y)*this.scale.y+.01:e.y<this.sizeY/2+1?e.y=this.sizeY/2+1:e.y>t.height-this.sizeY/2-1&&(e.y=t.height-this.sizeY/2-1),e.z=this.getWallOffset(),e.applyMatrix4(t.invInteriorTransform)}updateEdgeVisibility(e){this.visible=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(13);t.configDimUnit="dimUnit",t.configWallHeight="wallHeight",t.configWallThickness="wallThickness";class s{static setValue(e,t){this.data[e]=t}static getStringValue(e){switch(e){case t.configDimUnit:return this.data[e];default:throw new Error("Invalid string configuration parameter: "+e)}}static getNumericValue(e){switch(e){case t.configWallHeight:case t.configWallThickness:return this.data[e];default:throw new Error("Invalid numeric configuration parameter: "+e)}}}s.data={dimUnit:n.dimInch,wallHeight:250,wallThickness:10},t.Configuration=s},function(e,t,i){(function(i){var n,s=function(){this._tweens={},this._tweensAddedDuringUpdate={}};s.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(e=void 0!==e?e:o.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++){var s=this._tweens[i[n]];s&&!1===s.update(e)&&(s._isPlaying=!1,t||delete this._tweens[i[n]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var o=new s;o.Group=s,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof window&&void 0!==i?o.now=function(){var e=i.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?o.now=window.performance.now.bind(window.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,i,n;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(e-this._startTime)/this._duration,i=0===this._duration||i>1?1:i,n=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[t]){var s=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,n):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?s+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=s+(o-s)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===i){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var r=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=r}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var l=0,a=this._chainedTweens.length;l<a;l++)this._chainedTweens[l].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var i=e.length-1,n=i*t,s=Math.floor(n),r=o.Interpolation.Utils.Linear;return t<0?r(e[0],e[1],n):t>1?r(e[i],e[i-1],i-n):r(e[s],e[s+1>i?i:s+1],n-s)},Bezier:function(e,t){for(var i=0,n=e.length-1,s=Math.pow,r=o.Interpolation.Utils.Bernstein,l=0;l<=n;l++)i+=s(1-t,n-l)*s(t,l)*e[l]*r(n,l);return i},CatmullRom:function(e,t){var i=e.length-1,n=i*t,s=Math.floor(n),r=o.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(s=Math.floor(n=i*(1+t))),r(e[(s-1+i)%i],e[s],e[(s+1)%i],e[(s+2)%i],n-s)):t<0?e[0]-(r(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[i]-(r(e[i],e[i],e[i-1],e[i-1],n-i)-e[i]):r(e[s?s-1:0],e[s],e[i<s+1?i:s+1],e[i<s+2?i:s+2],n-s)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=o.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var n=t;n>1;n--)i*=n;return e[t]=i,i}}(),CatmullRom:function(e,t,i,n,s){var o=.5*(i-e),r=.5*(n-t),l=s*s;return(2*t-2*i+o+r)*(s*l)+(-3*t+3*i-2*o-r)*l+o*s+t}}},void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}).call(this,i(26))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),s=i(5);t.default=class extends s.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r)}placeInRoom(){if(!this.position_set){let e=this.model.floorplan.getCenter();this.position.x=e.x,this.position.z=e.z,this.position.y=.5*(this.geometry.boundingBox.max.y-this.geometry.boundingBox.min.y)}}resized(){this.position.y=this.halfSize.y}moveToPosition(e,t,i){this.isValidPosition(e)?(this.hideError(),i?(e.z=this.position.z,e.x=this.position.x,e.y=e.y-2*this.halfSize.y,e.y<this.halfSize.y&&(e.y=this.halfSize.y)):e.y=this.position.y,this.position.copy(e)):this.showError(e)}isValidPosition(e){let t=this.getCorners("x","z",e),i=this.model.floorplan.getRooms(),s=!1;for(let e=0;e<i.length;e++)n.default.polygonPolygonIntersect(t,i[e].interiorCorners)||(s=!0);return!!s}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(6);t.default=class extends n.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r),this.addToWall=!0}getWallOffset(){return.5-this.currentWallEdge.offset}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0),o=i(18);t.default=class extends o.default{constructor(e,t,i,s,o,r,l){super(e,t,i,s,o,r,l),this.addToWall=!1,this.boundToFloor=!1,this.currentWallEdge=null,this.refVec=new n.Vector2(0,1),this.wallOffsetScalar=0,this.sizeX=0,this.sizeY=0,this.allowRotate=!1}closestWallEdge(){let e=this.model.floorplan.wallEdges(),t=null,i=null,n=this.position.x,s=this.position.z;return e.forEach(e=>{let o=e.distanceTo(n,s);(null===i||o<i)&&(i=o,t=e)}),t}removed(){null!=this.currentWallEdge&&this.addToWall&&(s.default.removeValue(this.currentWallEdge.wall.items,this),this.redrawWall())}resized(){this.boundToFloor&&(this.position.y=.5*(this.geometry.boundingBox.max.y-this.geometry.boundingBox.min.y)*this.scale.y+.01),this.updateSize(),this.redrawWall()}placeInRoom(){let e=this.closestWallEdge();if(this.changeWallEdge(e),this.updateSize(),!this.position_set){let t=e.interiorCenter(),i=new n.Vector3(t.x,e.wall.height/2,t.y);this.boundMove(i),this.position.copy(i),this.redrawWall()}}moveToPosition(e,t,i){this.changeWallEdge(t.object.edge),this.boundMove(e),this.position.copy(e),this.redrawWall()}customIntersectionPlanes(){return this.model.floorplan.wallEdgePlanes()}getWallOffset(){return this.wallOffsetScalar}redrawWall(){this.addToWall&&this.currentWallEdge.wall.fireRedraw()}updateEdgeVisibility(e){this.visible=e}updateSize(){this.wallOffsetScalar=(this.geometry.boundingBox.max.z-this.geometry.boundingBox.min.z)*this.scale.z/2,this.sizeX=(this.geometry.boundingBox.max.x-this.geometry.boundingBox.min.x)*this.scale.x,this.sizeY=(this.geometry.boundingBox.max.y-this.geometry.boundingBox.min.y)*this.scale.y}changeWallEdge(e){null!=this.currentWallEdge&&(this.addToWall?(s.default.removeValue(this.currentWallEdge.wall.items,this),this.redrawWall()):s.default.removeValue(this.currentWallEdge.wall.onItems,this)),null!=this.currentWallEdge&&this.currentWallEdge.wall.dontFireOnDelete(this.remove.bind(this)),e.wall.fireOnDelete(this.remove.bind(this));let t=new n.Vector2,i=e.plane.geometry.faces[0].normal;t.x=i.x,t.y=i.z;let o=s.default.angle(this.refVec.x,this.refVec.y,t.x,t.y);this.rotation.y=o,this.currentWallEdge=e,this.addToWall?(e.wall.items.push(this),this.redrawWall()):e.wall.onItems.push(this)}boundMove(e){let t=this.currentWallEdge;e.applyMatrix4(t.interiorTransform),e.x<this.sizeX/2+1?e.x=this.sizeX/2+1:e.x>t.interiorDistance()-this.sizeX/2-1&&(e.x=t.interiorDistance()-this.sizeX/2-1),this.boundToFloor?e.y=.5*(this.geometry.boundingBox.max.y-this.geometry.boundingBox.min.y)*this.scale.y+.01:e.y<this.sizeY/2+1?e.y=this.sizeY/2+1:e.y>t.height-this.sizeY/2-1&&(e.y=t.height-this.sizeY/2-1),e.z=this.getWallOffset(),e.applyMatrix4(t.invInteriorTransform)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(13),s=i(0);t.floorplannerModes={MOVE:0,DRAW:1,DELETE:2};const o=20,r=1,l="#f1f1f1",a="#f9f9f9",h=5,c=7,d="#dddddd",u="#008cba",f="#888888",p="#008cba",m=1,g="#ff0000",y=0,w=7,x="#cccccc",v="#008cba";t.FloorplannerView=class{constructor(e,t,i){this.floorplan=e,this.viewmodel=t,this.canvas=i,this.canvasElement=document.getElementById(i),this.context=this.canvasElement.getContext("2d"),this.handleWindowResize(),window.addEventListener("resize",()=>{this.handleWindowResize()})}handleWindowResize(){let e=document.getElementById(this.canvas),t=e.parentNode;e.style.height=t.offsetHeight+"px",e.style.width=t.offsetWidth+"px",this.canvasElement.height=t.offsetHeight,this.canvasElement.width=t.offsetWidth,this.draw()}draw(){this.context.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),this.drawGrid(),this.floorplan.getRooms().forEach(e=>{this.drawRoom(e)}),this.floorplan.getWalls().forEach(e=>{this.drawWall(e)}),this.floorplan.getCorners().forEach(e=>{this.drawCorner(e)}),this.viewmodel.mode===t.floorplannerModes.DRAW&&this.drawTarget(this.viewmodel.targetX,this.viewmodel.targetY,this.viewmodel.lastNode),this.floorplan.getWalls().forEach(e=>{this.drawWallLabels(e)})}drawWallLabels(e){e.backEdge&&e.frontEdge?e.backEdge.interiorDistance<e.frontEdge.interiorDistance?this.drawEdgeLabel(e.backEdge):this.drawEdgeLabel(e.frontEdge):e.backEdge?this.drawEdgeLabel(e.backEdge):e.frontEdge&&this.drawEdgeLabel(e.frontEdge)}drawWall(e){let i=e===this.viewmodel.activeWall,n=d;i&&this.viewmodel.mode===t.floorplannerModes.DELETE?n=g:i&&(n=u),this.drawLine(this.viewmodel.convertX(e.getStartX()),this.viewmodel.convertY(e.getStartY()),this.viewmodel.convertX(e.getEndX()),this.viewmodel.convertY(e.getEndY()),i?c:h,n),!i&&e.frontEdge&&this.drawEdge(e.frontEdge,i),!i&&e.backEdge&&this.drawEdge(e.backEdge,i)}drawEdgeLabel(e){let t=e.interiorCenter(),i=e.interiorDistance();i<60||(this.context.font="normal 12px Arial",this.context.fillStyle="#000000",this.context.textBaseline="middle",this.context.textAlign="center",this.context.strokeStyle="#ffffff",this.context.lineWidth=4,this.context.strokeText(n.Dimensioning.cmToMeasure(i),this.viewmodel.convertX(t.x),this.viewmodel.convertY(t.y)),this.context.fillText(n.Dimensioning.cmToMeasure(i),this.viewmodel.convertX(t.x),this.viewmodel.convertY(t.y)))}drawEdge(e,i){let n=f;i&&this.viewmodel.mode===t.floorplannerModes.DELETE?n=g:i&&(n=p);let o=e.corners();this.drawPolygon(s.default.map(o,e=>this.viewmodel.convertX(e.x)),s.default.map(o,e=>this.viewmodel.convertY(e.y)),!1,null,!0,n,m)}drawRoom(e){this.drawPolygon(s.default.map(e.corners,e=>this.viewmodel.convertX(e.x)),s.default.map(e.corners,e=>this.viewmodel.convertY(e.y)),!0,a)}drawCorner(e){let i=e===this.viewmodel.activeCorner,n=x;i&&this.viewmodel.mode===t.floorplannerModes.DELETE?n=g:i&&(n=v),this.drawCircle(this.viewmodel.convertX(e.x),this.viewmodel.convertY(e.y),i?w:y,n)}drawTarget(e,t,i){this.drawCircle(this.viewmodel.convertX(e),this.viewmodel.convertY(t),w,v),this.viewmodel.lastNode&&this.drawLine(this.viewmodel.convertX(i.x),this.viewmodel.convertY(i.y),this.viewmodel.convertX(e),this.viewmodel.convertY(t),c,u)}drawLine(e,t,i,n,s,o){this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(i,n),this.context.lineWidth=s,this.context.strokeStyle=o,this.context.stroke()}drawPolygon(e,t,i,n,s,o,r){i=i||!1,s=s||!1,this.context.beginPath(),this.context.moveTo(e[0],t[0]);for(let i=1;i<e.length;i++)this.context.lineTo(e[i],t[i]);this.context.closePath(),i&&(this.context.fillStyle=n,this.context.fill()),s&&(this.context.lineWidth=r,this.context.strokeStyle=o,this.context.stroke())}drawCircle(e,t,i,n){this.context.beginPath(),this.context.arc(e,t,i,0,2*Math.PI,!1),this.context.fillStyle=n,this.context.fill()}calculateGridOffset(e){return e>=0?(e+o/2)%o-o/2:(e-o/2)%o+o/2}drawGrid(){let e=this.calculateGridOffset(-this.viewmodel.originX),t=this.calculateGridOffset(-this.viewmodel.originY),i=this.canvasElement.width,n=this.canvasElement.height;for(let t=0;t<=i/o;t++)this.drawLine(o*t+e,0,o*t+e,n,r,l);for(let e=0;e<=n/o;e++)this.drawLine(0,o*e+t,i,o*e+t,r,l)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(7);t.dimInch="inch",t.dimMeter="m",t.dimCentiMeter="cm",t.dimMilliMeter="mm";t.Dimensioning=class{static cmToMeasure(e){switch(n.Configuration.getStringValue(n.configDimUnit)){case t.dimInch:let i=.3937*e/12,s=Math.floor(i);return s+"'"+Math.round(12*(i-s))+'"';case t.dimMilliMeter:return Math.round(10*e)+" mm";case t.dimCentiMeter:return Math.round(10*e)/10+" cm";case t.dimMeter:default:return Math.round(10*e)/1e3+" m"}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1);let s=1e-5,o=0,r=1,l=2,a=3;class h{constructor(e,t){if(e instanceof n.Geometry)this.matrix=t||new n.Matrix4;else{if(!(e instanceof n.Mesh)){if(e instanceof u)return this.tree=e,this.matrix=t||new n.Matrix4,this;throw new Error("ThreeBSP: Given geometry is unsupported")}e.updateMatrix(),this.matrix=e.matrix.clone(),e=e.geometry}let i,s,o,r,l,a=[];for(let t=0,h=e.faces.length;t<h;t++){if(i=e.faces[t],o=e.faceVertexUvs[0][t],l=new c,!(i instanceof n.Face3))throw new Error("Invalid face type at index "+t);s=e.vertices[i.a],r=o?new n.Vector2(o[0].x,o[0].y):null,(s=new d(s.x,s.y,s.z,i.vertexNormals[0],r)).applyMatrix4(this.matrix),l.vertices.push(s),s=e.vertices[i.b],r=o?new n.Vector2(o[1].x,o[1].y):null,(s=new d(s.x,s.y,s.z,i.vertexNormals[2],r)).applyMatrix4(this.matrix),l.vertices.push(s),s=e.vertices[i.c],r=o?new n.Vector2(o[2].x,o[2].y):null,(s=new d(s.x,s.y,s.z,i.vertexNormals[2],r)).applyMatrix4(this.matrix),l.vertices.push(s),l.calculateProperties(),a.push(l)}this.tree=new u(a)}subtract(e){let t=this.tree.clone(),i=e.tree.clone();return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),new h(t,this.matrix)}union(e){let t=this.tree.clone(),i=e.tree.clone();return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),new h(t,this.matrix)}intersect(e){let t=this.tree.clone(),i=e.tree.clone();return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),new h(t,this.matrix)}toGeometry(){let e,t,i,s,o,r,l,a,h,c,d=(new n.Matrix4).getInverse(this.matrix),u=new n.Geometry,f=this.tree.allPolygons(),p=f.length,m={};for(e=0;e<p;e++)for(s=(i=f[e]).vertices.length,t=2;t<s;t++)c=[],a=i.vertices[0],c.push(new n.Vector2(a.uv.x,a.uv.y)),(a=new n.Vector3(a.x,a.y,a.z)).applyMatrix4(d),void 0!==m[a.x+","+a.y+","+a.z]?o=m[a.x+","+a.y+","+a.z]:(u.vertices.push(a),o=m[a.x+","+a.y+","+a.z]=u.vertices.length-1),a=i.vertices[t-1],c.push(new n.Vector2(a.uv.x,a.uv.y)),(a=new n.Vector3(a.x,a.y,a.z)).applyMatrix4(d),void 0!==m[a.x+","+a.y+","+a.z]?r=m[a.x+","+a.y+","+a.z]:(u.vertices.push(a),r=m[a.x+","+a.y+","+a.z]=u.vertices.length-1),a=i.vertices[t],c.push(new n.Vector2(a.uv.x,a.uv.y)),(a=new n.Vector3(a.x,a.y,a.z)).applyMatrix4(d),void 0!==m[a.x+","+a.y+","+a.z]?l=m[a.x+","+a.y+","+a.z]:(u.vertices.push(a),l=m[a.x+","+a.y+","+a.z]=u.vertices.length-1),h=new n.Face3(o,r,l,new n.Vector3(i.normal.x,i.normal.y,i.normal.z)),u.faces.push(h),u.faceVertexUvs[0].push(c);return u}toMesh(e){let t=this.toGeometry(),i=new n.Mesh(t,e);return i.position.setFromMatrixPosition(this.matrix),i.rotation.setFromRotationMatrix(this.matrix),i}}class c{constructor(e=[],t,i){this.vertices=e,this.normal=t,this.w=i,e.length&&this.calculateProperties()}calculateProperties(){let e=this.vertices[0],t=this.vertices[1],i=this.vertices[2];return this.normal=t.clone().sub(e).cross(i.clone().sub(e)).normalize(),this.w=this.normal.clone().dot(e),this}clone(){let e=new c;for(let t=0,i=this.vertices.length;t<i;t++)e.vertices.push(this.vertices[t].clone());return e.calculateProperties(),e}flip(){let e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this}classifyVertex(e){let t=this.normal.dot(e)-this.w;return t<-s?l:t>s?r:o}classifySide(e){let t,i,n=0,s=0,h=e.vertices.length;for(let o=0;o<h;o++)t=e.vertices[o],(i=this.classifyVertex(t))===r?n++:i===l&&s++;return n>0&&0===s?r:0===n&&s>0?l:0===n&&0===s?o:a}splitPolygon(e,t,i,n,s){let h=this.classifySide(e);if(h===o)(this.normal.dot(e.normal)>0?t:i).push(e);else if(h===r)n.push(e);else if(h===l)s.push(e);else{let t,i,o,h,d,u,f,p=[],m=[];for(let n=0,s=e.vertices.length;n<s;n++)t=(n+1)%s,h=e.vertices[n],d=e.vertices[t],i=this.classifyVertex(h),o=this.classifyVertex(d),i!==l&&p.push(h),i!==r&&m.push(h),(i|o)===a&&(u=(this.w-this.normal.dot(h))/this.normal.dot(d.clone().sub(h)),f=h.interpolate(d,u),p.push(f),m.push(f));p.length>=3&&n.push(new c(p).calculateProperties()),m.length>=3&&s.push(new c(m).calculateProperties())}}}t.Polygon=c;class d extends n.Vector3{constructor(e,t,i,s=new n.Vector3,o=new n.Vector2){super(e,t,i),this.normal=s,this.uv=o}clone(){return new d(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())}interpolate(e,t){return this.clone().lerp(e,t)}}t.Vertex=d;class u{constructor(e){let t=[],i=[];if(this.polygons=[],this.front=this.back=void 0,e instanceof Array&&0!==e.length){this.divider=e[0].clone();for(let n=0,s=e.length;n<s;n++)this.divider.splitPolygon(e[n],this.polygons,this.polygons,t,i);t.length>0&&(this.front=new u(t)),i.length>0&&(this.back=new u(i))}}static isConvex(e){let t,i;for(t=0;t<e.length;t++)for(i=0;i<e.length;i++)if(t!==i&&e[t].classifySide(e[i])!==l)return!1;return!0}build(e){let t=[],i=[];this.divider||(this.divider=e[0].clone());for(let n=0,s=e.length;n<s;n++)this.divider.splitPolygon(e[n],this.polygons,this.polygons,t,i);t.length>0&&(this.front||(this.front=new u),this.front.build(t)),i.length>0&&(this.back||(this.back=new u),this.back.build(i))}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}clone(){let e=new u;return e.divider=this.divider.clone(),e.polygons=this.polygons.map(function(e){return e.clone()}),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e}invert(){let e;for(let e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),e=this.front,this.front=this.back,this.back=e,this}clipPolygons(e){let t,i;if(!this.divider)return e.slice();t=[],i=[];for(let n=0,s=e.length;n<s;n++)this.divider.splitPolygon(e[n],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}}t.BSPNode=u,t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(8),o=i(0),r={dbclick:[{obj_name:"doorRight",obj_event:(e,t)=>{!function(e,t){let i="close",r=null;if(null!=e.doorState&&void 0!==e.doorState)i=e.doorState,r=e.parent;else{let t=e.parent;(r=new n.Object3D).name="groupObj_"+o.default.guid(),r.position.set(e.position.x-e.geometry.parameters.width/2,e.position.y,e.position.z),e.position.set(e.geometry.parameters.width/2,0,0),r.add(e),t.add(r)}e.doorState="close"===i?"open":"close",new s.Tween(r.rotation).to({y:"close"===i?.5*Math.PI:0*Math.PI},1e4).onUpdate(function(e){t.scene.needsUpdate=!0}).easing(s.Easing.Elastic.Out).start()}(e,t)}},{obj_name:"doorLeft",obj_event:(e,t)=>{let i="close",r=null;if(null!=e.doorState&&void 0!==e.doorState)i=e.doorState,r=e.parent;else{let t=e.parent;(r=new n.Object3D).name="groupObj_"+o.default.guid(),r.position.set(e.position.x+e.geometry.parameters.width/2,e.position.y,e.position.z),e.position.set(-e.geometry.parameters.width/2,0,0),r.add(e),t.add(r)}e.doorState="close"===i?"open":"close",new s.Tween(r.rotation).to({y:"close"===i?-.5*Math.PI:0*Math.PI},1e4).onUpdate(function(e){t.scene.needsUpdate=!0}).easing(s.Easing.Elastic.Out).start()}},{findObject:e=>e.indexOf("cabinet_door")>=0,obj_event:(e,t,i)=>{!function(e,t){let i="close",l=null;if(null!=e.doorState&&void 0!==e.doorState)i=e.doorState,l=e.parent;else{let t=e.parent;(l=new n.Object3D).name="groupObj_"+o.default.guid(),l.position.set(e.position.x,e.position.y,e.position.z+e.geometry.parameters.depth/2),e.position.set(0,0,-e.geometry.parameters.depth/2);l.add(e);t.add(l)}e.doorState="close"===i?"open":"close",new s.Tween(l.rotation).to({y:"close"===i?.5*Math.PI:0*Math.PI},1e3).onUpdate(function(e){t.scene.needsUpdate=!0}).onStart(function(){"open"===e.doorState&&(null!==r.cabinetOpenCallback&&r.cabinetOpenCallback(l.parent),t.scene.needsUpdate=!0)}).onComplete(function(){if("close"===e.doorState)for(let e=l.parent.children.length-1;e>=0;e--){let t=l.parent.children[e];void 0!==t.name&&-1!==t.name.indexOf("equipment")&&l.parent.remove(t)}}).start()}(e,t)}},{findObject:e=>e.indexOf("equipment")>=0&&e.indexOf("card")>=0,obj_event:(e,t,i)=>{let n="in";null!=e.cardstate&&void 0!==e.cardstate?n=e.cardstate:e.cardstate="out",new s.Tween(e.position).to({x:"in"===n?e.position.x-50:e.position.x+50},1e3).onComplete(function(){e.cardstate="in"===n?"out":"in","out"===e.cardstate&&null!==r.equipmentClickCallback&&r.equipmentClickCallback(e)}).onUpdate(function(e){t.scene.needsUpdate=!0}).start()}}],cabinetOpenCallback:null,equipmentClickCallback:null};t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0),o=i(2);t.default=class{constructor(e,t,i){this.plane=null,this.interiorTransform=new n.Matrix4,this.invInteriorTransform=new n.Matrix4,this.redrawCallbacks=o.default(),this.exteriorTransform=new n.Matrix4,this.invExteriorTransform=new n.Matrix4,this.generatePlane=function(){function e(e){return new n.Vector3(e.x,0,e.y)}let t=e(this.interiorStart()),i=e(this.interiorEnd()),s=i.clone();s.y=this.wall.height;let o=t.clone();o.y=this.wall.height;let r=new n.Geometry;r.vertices=[t,i,s,o],r.faces.push(new n.Face3(0,1,2)),r.faces.push(new n.Face3(0,2,3)),r.computeFaceNormals(),r.computeBoundingBox(),this.plane=new n.Mesh(r,new n.MeshBasicMaterial),this.plane.edge=this,this.computeTransforms(this.interiorTransform,this.invInteriorTransform,this.interiorStart(),this.interiorEnd()),this.computeTransforms(this.exteriorTransform,this.invExteriorTransform,this.exteriorStart(),this.exteriorEnd())},this.room=e,this.wall=t,this.front=i||!1,this.offset=t.thickness/2,this.height=t.height,this.front?this.wall.frontEdge=this:this.wall.backEdge=this}getTexture(){return this.front?this.wall.frontTexture:this.wall.backTexture}setTexture(e,t,i){let n={url:e,stretch:t,scale:i};this.front?this.wall.frontTexture=n:this.wall.backTexture=n,this.redrawCallbacks.fire()}interiorDistance(){let e=this.interiorStart(),t=this.interiorEnd();return s.default.distance(e.x,e.y,t.x,t.y)}distanceTo(e,t){return s.default.pointDistanceFromLine(e,t,this.interiorStart().x,this.interiorStart().y,this.interiorEnd().x,this.interiorEnd().y)}interiorEnd(){let e=this.halfAngleVector(this,this.next);return{x:this.getEnd().x+e.x,y:this.getEnd().y+e.y}}interiorStart(){let e=this.halfAngleVector(this.prev,this);return{x:this.getStart().x+e.x,y:this.getStart().y+e.y}}interiorCenter(){return{x:(this.interiorStart().x+this.interiorEnd().x)/2,y:(this.interiorStart().y+this.interiorEnd().y)/2}}exteriorEnd(){let e=this.halfAngleVector(this,this.next);return{x:this.getEnd().x-e.x,y:this.getEnd().y-e.y}}exteriorStart(){let e=this.halfAngleVector(this.prev,this);return{x:this.getStart().x-e.x,y:this.getStart().y-e.y}}corners(){return[this.interiorStart(),this.interiorEnd(),this.exteriorEnd(),this.exteriorStart()]}computeTransforms(e,t,i,o){let r=i,l=o,a=s.default.angle(1,0,l.x-r.x,l.y-r.y),h=new n.Matrix4;h.makeTranslation(-r.x,0,-r.y);let c=new n.Matrix4;c.makeRotationY(-a),e.multiplyMatrices(c,h),t.getInverse(e)}getStart(){return this.front?this.wall.getStart():this.wall.getEnd()}getEnd(){return this.front?this.wall.getEnd():this.wall.getStart()}getOppositeEdge(){return this.front?this.wall.backEdge:this.wall.frontEdge}halfAngleVector(e,t){let i,n,o,r,l,a,h,c;e?(i=e.getStart().x,n=e.getStart().y,o=e.getEnd().x,r=e.getEnd().y):(i=t.getStart().x-(t.getEnd().x-t.getStart().x),n=t.getStart().y-(t.getEnd().y-t.getStart().y),o=t.getStart().x,r=t.getStart().y),t?(l=t.getStart().x,a=t.getStart().y,h=t.getEnd().x,c=t.getEnd().y):(l=e.getEnd().x,a=e.getEnd().y,h=e.getEnd().x+(e.getEnd().x-e.getStart().x),c=e.getEnd().y+(e.getEnd().y-e.getStart().y));let d=s.default.angle2pi(i-o,n-r,h-o,c-r),u=Math.cos(d/2),f=Math.sin(d/2),p=h-l,m=c-a,g=p*u-m*f,y=p*f+m*u,w=s.default.distance(0,0,g,y),x=this.offset/f/w;return{x:g*x,y:y*x}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(18),s=i(0);t.default=class extends n.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r)}placeInRoom(){if(!this.position_set){let e=this.model.floorplan.getCenter();this.position.x=e.x,this.position.z=e.z,this.position.y=.5*(this.geometry.boundingBox.max.y-this.geometry.boundingBox.min.y)}}resized(){this.position.y=this.halfSize.y}moveToPosition(e,t,i){this.isValidPosition(e)?(this.hideError(),e.y=this.position.y,this.position.copy(e)):this.showError(e)}isValidPosition(e){let t=this.getCorners("x","z",e),i=this.model.floorplan.getRooms(),n=!1;for(let o=0;o<i.length;o++)s.default.pointInPolygon(e.x,e.z,i[o].interiorCorners)&&!s.default.polygonPolygonIntersect(t,i[o].interiorCorners)&&(n=!0);return!!n}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0);t.default=class extends n.Mesh{constructor(e,t,i,s,o,r,l){super(),this.fixed=!1,this.obstructFloorMoves=!0,this.allowRotate=!0,this.allowYDrag=!1,this.errorGlow=new n.Mesh,this.hover=!1,this.selected=!1,this.highlighted=!1,this.error=!1,this.emissiveColor=4473924,this.errorColor=16711680,this.dragOffset=new n.Vector3,this.model=e,this.metadata=t,this.scene=this.model.scene,this.geometry=i,this.material=s,this.errorColor=16711680,this.resizable=t.resizable,this.castShadow=!0,this.receiveShadow=!1,o?(this.position.copy(o),this.position_set=!0):this.position_set=!1,this.geometry.computeBoundingBox(),this.geometry.applyMatrix((new n.Matrix4).makeTranslation(-.5*(this.geometry.boundingBox.max.x+this.geometry.boundingBox.min.x),-.5*(this.geometry.boundingBox.max.y+this.geometry.boundingBox.min.y),-.5*(this.geometry.boundingBox.max.z+this.geometry.boundingBox.min.z))),this.geometry.computeBoundingBox(),this.halfSize=this.objectHalfSize(),r&&(this.rotation.y=r),null!=l&&this.setScale(l.x,l.y,l.z)}removeSelf(){this.scene.removeItem(this)}resize(e,t,i){let n=t/this.getWidth(),s=e/this.getHeight(),o=i/this.getDepth();this.setScale(n,s,o)}setScale(e,t,i){let s=new n.Vector3(e,t,i);this.halfSize.multiply(s),s.multiply(this.scale),this.scale.set(s.x,s.y,s.z),this.resized(),this.scene.needsUpdate=!0}setFixed(e){this.fixed=e}getHeight(){return 2*this.halfSize.y}getWidth(){return 2*this.halfSize.x}getDepth(){return 2*this.halfSize.z}initObject(){this.placeInRoom(),this.scene.needsUpdate=!0}removed(){return null}updateHighlight(){let e=this.hover||this.selected;this.highlighted=e;let t=e?this.emissiveColor:0;this.material.emissive.setHex(t)}mouseOver(){this.hover=!0,this.updateHighlight()}mouseOff(){this.hover=!1,this.updateHighlight()}setSelected(){this.selected=!0,this.updateHighlight()}setUnselected(){this.selected=!1,this.updateHighlight()}clickPressed(e){this.dragOffset.copy(e.point).sub(this.position)}clickDragged(e,t){e&&this.moveToPosition(e.point.sub(this.dragOffset),e,t)}rotate(e){if(e){let t=s.default.angle(0,1,e.point.x-this.position.x,e.point.z-this.position.z),i=Math.PI/16;for(let e=-4;e<=4;e++)if(Math.abs(t-e*(Math.PI/2))<i){t=e*(Math.PI/2);break}this.rotation.y=t}}moveToPosition(e,t,i){this.position.copy(e)}clickReleased(){this.error&&this.hideError()}customIntersectionPlanes(){return[]}getCorners(e,t,i){i=i||this.position;let s=this.halfSize.clone(),o=new n.Vector3(-s.x,0,-s.z),r=new n.Vector3(s.x,0,-s.z),l=new n.Vector3(s.x,0,s.z),a=new n.Vector3(-s.x,0,s.z),h=new n.Matrix4;return h.makeRotationY(this.rotation.y),o.applyMatrix4(h),r.applyMatrix4(h),l.applyMatrix4(h),a.applyMatrix4(h),o.add(i),r.add(i),l.add(i),a.add(i),[{x:o.x,y:o.z},{x:r.x,y:r.z},{x:l.x,y:l.z},{x:a.x,y:a.z}]}showError(e){e=e||this.position,this.error||(this.error=!0,this.errorGlow=this.createGlow(this.errorColor,.8,!0),this.scene.add(this.errorGlow)),this.errorGlow.position.copy(e)}hideError(){this.error&&(this.error=!1,this.scene.remove(this.errorGlow))}createGlow(e,t,i){i=i||!1,t=t||.2;let s=new n.MeshBasicMaterial({color:e,blending:n.AdditiveBlending,opacity:.2,transparent:!0,depthTest:!i}),o=new n.Mesh(this.geometry.clone(),s);return o.position.copy(this.position),o.rotation.copy(this.rotation),o.scale.copy(this.scale),o}objectHalfSize(){let e=new n.Box3;return e.setFromObject(this),e.max.clone().sub(e.min).divideScalar(2)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(11);t.default=class extends n.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r),this.addToWall=!0}getWallOffset(){return.5-this.currentWallEdge.offset}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(21),s=i(22),o=i(33),r=i(15),l=i(12),a=i(3),h=i(0);t.Mode=l.floorplannerModes;t.Oasis3d=class{constructor(e){e.roomTextureDir&&a.default.setRoomTextureDir(e.roomTextureDir),e.resourceDir&&a.default.setResourceDir(e.resourceDir),this.model=new o.default,this.three=new s.Main(this.model,e.threeElement,{}),e.widget?this.three.getController().enabled=!1:this.floorplanner=new n.default(e.floorplannerElement,this.model.floorplan)}setCabinetOpenCallback(e){"function"==typeof e&&(r.default.cabinetOpenCallback=e)}setEquipmentClickCallback(e){"function"==typeof e&&(r.default.equipmentClickCallback=e)}addDbclickEvt(e){if(void 0===e||null===e||"function"!=typeof e.obj_event||void 0===e.findObject&&void 0===e.obj_name&&void 0===e.obj_uuid)throw new Error("The parameter obj is not in the correct format, please check it!");console.log(e),r.default.dbclick.push(e)}},t.Utils=h.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(12),s=i(2),o=i(0),r=25;t.default=class{constructor(e,t){this.mode=0,this.activeWall=null,this.activeCorner=null,this.originX=0,this.originY=0,this.targetX=0,this.targetY=0,this.lastNode=null,this.modeResetCallbacks=s.default(),this.mouseDown=!1,this.mouseMoved=!1,this.mouseX=0,this.mouseY=0,this.rawMouseX=0,this.rawMouseY=0,this.lastX=0,this.lastY=0,this.floorplan=t,this.canvasElement=document.getElementById(e),this.view=new n.FloorplannerView(this.floorplan,this,e),this.cmPerPixel=2.032,this.pixelsPerCm=1/this.cmPerPixel,this.wallWidth=10*this.pixelsPerCm,this.setMode(n.floorplannerModes.MOVE),this.canvasElement.addEventListener("mousedown",e=>{this.mousedown()}),this.canvasElement.addEventListener("mouseup",e=>{this.mouseup()}),this.canvasElement.addEventListener("mousemove",e=>{this.mousemove(e)}),this.canvasElement.addEventListener("mouseleave",e=>{this.mouseleave()}),window.addEventListener("keyup",e=>{27===e.keyCode&&this.escapeKey()},!1),this.floorplan.roomLoadedCallbacks.add(()=>{this.reset()})}convertX(e){return(e-this.originX*this.cmPerPixel)*this.pixelsPerCm}convertY(e){return(e-this.originY*this.cmPerPixel)*this.pixelsPerCm}escapeKey(){this.setMode(n.floorplannerModes.MOVE)}updateTarget(){this.mode===n.floorplannerModes.DRAW&&this.lastNode?(Math.abs(this.mouseX-this.lastNode.x)<r?this.targetX=this.lastNode.x:this.targetX=this.mouseX,Math.abs(this.mouseY-this.lastNode.y)<r?this.targetY=this.lastNode.y:this.targetY=this.mouseY):(this.targetX=this.mouseX,this.targetY=this.mouseY),this.view.draw()}mousedown(){this.mouseDown=!0,this.mouseMoved=!1,this.lastX=this.rawMouseX,this.lastY=this.rawMouseY,this.mode===n.floorplannerModes.DELETE&&(this.activeCorner?this.activeCorner.removeAll():this.activeWall?this.activeWall.remove():this.setMode(n.floorplannerModes.MOVE))}mousemove(e){if(this.mouseMoved=!0,this.rawMouseX=e.clientX,this.rawMouseY=e.clientY,this.mouseX=(e.clientX-o.default.getElementPosition(this.canvasElement).left)*this.cmPerPixel+this.originX*this.cmPerPixel,this.mouseY=(e.clientY-o.default.getElementPosition(this.canvasElement).top)*this.cmPerPixel+this.originY*this.cmPerPixel,(this.mode===n.floorplannerModes.DRAW||this.mode===n.floorplannerModes.MOVE&&this.mouseDown)&&this.updateTarget(),this.mode!==n.floorplannerModes.DRAW&&!this.mouseDown){let e=this.floorplan.overlappedCorner(this.mouseX,this.mouseY),t=this.floorplan.overlappedWall(this.mouseX,this.mouseY),i=!1;e!==this.activeCorner&&(this.activeCorner=e,i=!0),null==this.activeCorner?t!==this.activeWall&&(this.activeWall=t,i=!0):this.activeWall=null,i&&this.view.draw()}!this.mouseDown||this.activeCorner||this.activeWall||(this.originX+=this.lastX-this.rawMouseX,this.originY+=this.lastY-this.rawMouseY,this.lastX=this.rawMouseX,this.lastY=this.rawMouseY,this.view.draw()),this.mode===n.floorplannerModes.MOVE&&this.mouseDown&&(this.activeCorner?(this.activeCorner.move(this.mouseX,this.mouseY),this.activeCorner.snapToAxis(r)):this.activeWall&&(this.activeWall.relativeMove((this.rawMouseX-this.lastX)*this.cmPerPixel,(this.rawMouseY-this.lastY)*this.cmPerPixel),this.activeWall.snapToAxis(r),this.lastX=this.rawMouseX,this.lastY=this.rawMouseY),this.view.draw())}mouseup(){if(this.mouseDown=!1,this.mode===n.floorplannerModes.DRAW&&!this.mouseMoved){let e=this.floorplan.newCorner(this.targetX,this.targetY);null!=this.lastNode&&this.floorplan.newWall(this.lastNode,e),e.mergeWithIntersected()&&null!=this.lastNode&&this.setMode(n.floorplannerModes.MOVE),this.lastNode=e}}mouseleave(){this.mouseDown=!1}reset(){this.resizeView(),this.setMode(n.floorplannerModes.MOVE),this.resetOrigin(),this.view.draw()}resizeView(){this.view.handleWindowResize()}setMode(e){this.lastNode=null,this.mode=e,this.modeResetCallbacks.fire(e),this.updateTarget()}resetOrigin(){let e=this.canvasElement.clientWidth/2,t=this.canvasElement.clientHeight/2,i=this.floorplan.getCenter();this.originX=i.x*this.pixelsPerCm-e,this.originY=i.z*this.pixelsPerCm-t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(23),o=i(24),r=i(25),l=i(27),a=i(30),h=i(31),c=i(32),d=i(8),u=i(2),f=i(0);t.Main=function(e,t,i){let p=this,m={resize:!0,pushHref:!1,spin:!0,spinSpeed:2e-5,clickPan:!0,canMoveFixedItems:!1};for(let e in m)m.hasOwnProperty(e)&&i.hasOwnProperty(e)&&(m[e]=i[e]);let g,y,w,x,v,b=e,E=b.scene;this.element=document.getElementById(t);let M,k,_=!1,C=Date.now(),S=!1,T=!1;function O(){!function(){if(m.spin&&!S&&!T){let e=2*Math.PI*m.spinSpeed*(Date.now()-C);p.controls.rotateLeft(e),p.controls.update()}}(),(p.controls.needsUpdate||x.needsUpdate||_||b.scene.needsUpdate)&&(p.controls.needsUpdate=!1,x.needsUpdate=!1,_=!1,b.scene.needsUpdate=!1,1)&&(w.clear(),w.render(E.getScene(),y),w.clearDepth(),w.render(M.getScene(),y),w.render(k.getScene(),y)),C=Date.now()}function z(){setTimeout(function(){requestAnimationFrame(z)},50),d.update(),O()}this.itemSelectedCallbacks=u.default(),this.itemUnselectedCallbacks=u.default(),this.wallClicked=u.default(),this.floorClicked=u.default(),this.nothingClicked=u.default(),this.dataUrl=function(){return w.domElement.toDataURL("image/png")},this.stopSpin=function(){T=!0},this.startSpin=function(){T=!1},this.options=function(){return m},this.getModel=function(){return b},this.getScene=function(){return E},this.getController=function(){return x},this.getFloorplan=function(){return v},this.getCamera=function(){return y},this.needsUpdate=function(){_=!0},this.rotatePressed=function(){x.rotatePressed()},this.rotateReleased=function(){x.rotateReleased()},this.setCursorStyle=function(e){g.style.cursor=e},this.updateWindowSize=function(){let e=f.default.getElementPosition(p.element);p.heightMargin=e.top,p.widthMargin=e.left,p.elementWidth=p.element.clientWidth,m.resize?p.elementHeight=window.innerHeight-p.heightMargin:p.elementHeight=p.element.clientHeight,y.aspect=p.elementWidth/p.elementHeight,y.updateProjectionMatrix(),w.setSize(p.elementWidth,p.elementHeight),_=!0},this.centerCamera=function(){let e=b.floorplan.getCenter();e.y=150,p.controls.target=e;let t=1.5*b.floorplan.getSize().z,i=e.clone().add(new n.Vector3(0,t,t));y.position.copy(i),p.controls.update()},this.projectVector=function(e,t){t=t||!1;let i=p.elementWidth/2,s=p.elementHeight/2,o=new n.Vector3;o.copy(e),o.project(y);let r=new n.Vector2;return r.x=o.x*i+i,r.y=-o.y*s+s,t||(r.x+=p.widthMargin,r.y+=p.heightMargin),r},n.ImageUtils.crossOrigin="",g=p.element,y=new n.PerspectiveCamera(45,1,1,1e4),(w=new n.WebGLRenderer({alpha:!0,antialias:!0})).autoClear=!1,w.shadowMap.enabled=!0,w.shadowMapSoft=!0,w.shadowMap.type=n.PCFSoftShadowMap,new h.Skybox(E),p.controls=new a.Controls(y,g),p.controls.addListeners(),M=new s.HUD(p),k=new o.YHUD(p),x=new r.Controller(p,b,y,p.element,p.controls,M,k),g.appendChild(w.domElement),p.updateWindowSize(),m.resize&&window.addEventListener("resize",p.updateWindowSize),p.centerCamera(),b.floorplan.fireOnUpdatedRooms(p.centerCamera),new c.Lights(E,b.floorplan),v=new l.Floorplan(E,b.floorplan,p.controls),z(),p.element.addEventListener("mouseover",function(){S=!0},!1),p.element.addEventListener("mouseleave",function(){S=!1},!1),p.element.addEventListener("click",function(){T=!0},!1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1);t.HUD=function(e){let t=e,i=new n.Scene,s=null,o=!1,r=!1,l=20,a="#ffffff",h="#f1c40f",c=null;function d(){s=null,c&&(i.remove(c),c=null)}function u(e){s!==e&&(d(),e.allowRotate&&!e.fixed&&(c=function(e){let t=new n.Object3D,i=new n.LineSegments(function(e){let t=new n.Geometry;return t.vertices.push(new n.Vector3(0,0,0),g(e)),t}(e),new n.LineBasicMaterial({color:m(),linewidth:3})),s=function(e){let t=new n.CylinderGeometry(5,0,10),i=new n.MeshBasicMaterial({color:m()}),s=new n.Mesh(t,i);return s.position.copy(g(e)),s.rotation.x=-Math.PI/2,s}(e),o=function(e){let t=new n.SphereGeometry(4,16,16),i=new n.MeshBasicMaterial({color:m()});return new n.Mesh(t,i)}();return t.add(i),t.add(s),t.add(o),t.rotation.y=e.rotation.y,t.position.x=e.position.x,t.position.z=e.position.z,t.position.y=e.position.y-e.halfSize.y,t}(s=e),i.add(c)))}function f(){d()}function p(){c&&c.children.forEach(e=>{e.material.color.set(m())}),t.needsUpdate()}function m(){return r||o?h:a}function g(e){return new n.Vector3(0,0,Math.max(e.halfSize.x,e.halfSize.z)+1.4+l)}this.getScene=function(){return i},this.getObject=function(){return c},this.setRotating=function(e){o=e,p()},this.setMouseover=function(e){r=e,p()},this.update=function(){c&&(c.rotation.y=s.rotation.y,c.position.x=s.position.x,c.position.y=s.position.y-s.halfSize.y,c.position.z=s.position.z)},t.itemSelectedCallbacks.add(u),t.itemUnselectedCallbacks.add(f)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1);t.YHUD=function(e){let t=e,i=new n.Scene,s=null,o=!1,r=!1,l=20,a="#ffffff",h="#f1c40f",c=null;function d(){s=null,c&&(i.remove(c),c=null)}function u(e){s!==e&&(d(),e.allowYDrag&&!e.fixed&&(c=function(e){let t=new n.Object3D,i=new n.LineSegments(function(e){let t=new n.Geometry;return t.vertices.push(new n.Vector3(0,0,0),g(e)),t}(e),new n.LineBasicMaterial({color:m(),linewidth:3})),s=function(e){let t=new n.CylinderGeometry(5,0,10),i=new n.MeshBasicMaterial({color:m()}),s=new n.Mesh(t,i);return s.position.copy(g(e)),s.rotation.x=Math.PI,s}(e),o=function(e){let t=new n.SphereGeometry(4,16,16),i=new n.MeshBasicMaterial({color:m()});return new n.Mesh(t,i)}();return t.add(i),t.add(s),t.add(o),t.position.x=e.position.x,t.position.z=e.position.z,t.position.y=e.position.y+e.halfSize.y,t}(s=e),i.add(c)))}function f(){d()}function p(){c&&c.children.forEach(e=>{e.material.color.set(m())}),t.needsUpdate()}function m(){return r||o?h:a}function g(e){return new n.Vector3(0,Math.max(e.halfSize.x,e.halfSize.y)/2+1.4+l,0)}this.getScene=function(){return i},this.getPlane=function(){},this.getObject=function(){return c},this.setDragging=function(e){o=e,p()},this.setMouseover=function(e){r=e,p()},this.update=function(){c&&(c.position.x=s.position.x,c.position.z=s.position.z,c.position.y=s.position.y+s.halfSize.y)},t.itemSelectedCallbacks.add(u),t.itemUnselectedCallbacks.add(f)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0),o=i(15),r=i(9),l=i(6),a=i(10),h=i(5),c=i(3),d=i(4),u=i(8);t.Controller=function(e,t,i,f,p,m,g){let y=this;this.enabled=!0;let w=f,x=i,v=t.scene;this.scene=v,this.model=t;let b,E,M,k,_,C,S=p,T=m,O=g,z=e,P=!1,j=!1,I=!1,D=!1,W=!1,V=!1,L=!1;this.dbclick=0;let R={UNSELECTED:0,SELECTED:1,DRAGGING:2,ROTATING:3,ROTATING_FREE:4,PANNING:5,YDRAGGING:6},G=R.UNSELECTED,U=!0;function F(e){if(!e.position_set){y.setSelectedObject(e);let t=e.position.clone();t.y=0,B(z.projectVector(t))}e.position_set=!0}function B(e){e=e||M;let t=Z(M,C);t&&C.clickPressed(t)}this.getCamera=function(){return x},this.setCamera=function(e){x=e},this.init=function(){w.addEventListener("mousedown",e=>{!function(e,i){if(y.enabled)switch(e.preventDefault(),j=!1,P=!0,G){case R.SELECTED:I?q(R.ROTATING):D?(q(R.YDRAGGING),k=null):null!=k&&(y.setSelectedObject(k),k.fixed||q(R.DRAGGING));break;case R.UNSELECTED:null!=k&&(y.setSelectedObject(k),k.fixed||q(R.DRAGGING));break;case R.DRAGGING:case R.YDRAGGING:case R.ROTATING:break;case R.ROTATING_FREE:q(R.SELECTED)}else{let n="",s=i;s.dbclick++,setTimeout(function(){n=s.dbclick>=2?"dbclick":1===s.dbclick?"click":"",s.dbclick=0,function(e,i,n){let s=i;if(""===e)return;M.x=i.clientX,M.y=i.clientY;let h=[],c=t.scene.getItems();for(let e=0,t=c.length;e<t;e++)(c[e]instanceof r.default&&0===c[e].name.indexOf("emptyCabinet")||c[e]instanceof a.default&&0===c[e].name.indexOf("glassDoor"))&&(h=h.concat(c[e].children)),c[e]instanceof l.default&&0===c[e].name.indexOf("camera")&&(h=h.concat(c[e].children));for(let e=0,t=h.length;e<t;e++)void 0!==h[e].name&&0===h[e].name.indexOf("groupObj")&&h.splice(e,1,h[e].children[0]);h=h.concat(c);let d=K(M,h,!1,!0),u=null;d.length>0?(u=d[0].object,"dbclick"===e&&null!=o.default&&null!=o.default.dbclick&&o.default.dbclick.length>0&&o.default.dbclick.forEach(function(e,t){"string"==typeof e.obj_name?0===u.name.indexOf(e.obj_name)&&e.obj_event(u,n,s):"string"==typeof e.obj_uuid?u.uuid===e.obj_uuid&&e.obj_event(u,n,s):null==e.findObject&&"function"!=typeof e.findObject||e.findObject(u.name)&&e.obj_event(u,n,s)})):console.log(d)}(n,e,i)},500),e.preventDefault()}}(e,this)}),w.addEventListener("mouseup",X),w.addEventListener("mousemove",H),M=new n.Vector2,v.itemRemovedCallbacks.add(N),v.itemLoadedCallbacks.add(F),function(){let e=new n.GridHelper(1e4,150);v.add(e),(b=new n.Mesh(new n.PlaneGeometry(1e4,1e4),new n.MeshBasicMaterial({visible:!1,side:n.DoubleSide,color:16711680}))).position.y=b.position.y-2,b.rotation.x=-Math.PI/2,v.add(b),E=new n.Mesh(new n.PlaneGeometry(1e4,1e4),new n.MeshBasicMaterial({visible:!1,side:n.DoubleSide,color:65280})),v.add(E)}()};const A=e=>{e=e||M;let t=Z(M,C);t&&(y.isRotating()?C.rotate(t):C.clickDragged(t,G===R.YDRAGGING))};function N(e){e===C&&(C.setUnselected(),C.mouseOff(),y.setSelectedObject(null))}function Y(e){if(G===R.UNSELECTED&&null==_){let e=t.floorplan.wallEdgePlanes(),i=K(M,e,!0);if(i.length>0){let e=i[0].object.edge;return void z.wallClicked.fire(e)}let n=t.floorplan.floorPlanes(),s=K(M,n,!1);if(s.length>0){let e=s[0].object.room;return void z.floorClicked.fire(e)}z.nothingClicked.fire()}}function H(e){if(y.enabled)switch(e.preventDefault(),j=!0,M.x=e.clientX,M.y=e.clientY,P||function(){let e=T.getObject();if(null!=e){let t=K(M,e,!1,!1,!0);if(t.length>0)return I=!0,T.setMouseover(!0),void(k=null)}I=!1,T.setMouseover(!1);let i=O.getObject();if(null!=i){let e=K(M,i,!1,!1,!0);if(e.length>0)return D=!0,O.setMouseover(!0),void(k=null)}D=!1,O.setMouseover(!1);let n=t.scene.getItems();for(let e=0;e<n.length;e++)n[e]instanceof a.default&&(n=1===(n=1===n[e].children[0].children.length?n.concat(n[e].children[0].children):n.concat([n[e].children[0]]))[e].children[1].children.length?n.concat(n[e].children[1].children):n.concat([n[e].children[1]])),n[e]instanceof l.default&&0===n[e].name.indexOf("camera")&&(n=n.concat(n[e].children));let s=K(M,n,!1,!0);if(s.length>0)if(s[0].object.name.indexOf("customGlass")>=0){let e=s[0].object.parent;0===e.name.indexOf("groupObj")&&(e=e.parent),e.visible?k=e:s.length>=2&&-1===s[1].object.name.indexOf("customGlass")&&(k=s[1].object)}else k=0===s[0].object.name.indexOf("gleye")?s[0].object.parent:s[0].object;else k=null}(),G){case R.UNSELECTED:case R.SELECTED:Q();break;case R.DRAGGING:case R.YDRAGGING:case R.ROTATING:case R.ROTATING_FREE:A(),T.update(),O.update(),y.needsUpdate=!0}}function X(e){if(y.enabled)switch(P=!1,G){case R.YDRAGGING:case R.DRAGGING:C.clickReleased(),q(R.SELECTED);break;case R.ROTATING:q(j?R.SELECTED:R.ROTATING_FREE);break;case R.UNSELECTED:j||Y();break;case R.SELECTED:null!=k||j||(q(R.UNSELECTED),Y());break;case R.ROTATING_FREE:}}function q(e){e!==G&&(function(e){switch(e){case R.UNSELECTED:case R.SELECTED:break;case R.DRAGGING:_?z.setCursorStyle("pointer"):z.setCursorStyle("auto");break;case R.ROTATING:case R.ROTATING_FREE:}}(G),function(e){switch(e){case R.UNSELECTED:y.setSelectedObject(null);break;case R.SELECTED:S.enabled=!0;break;case R.ROTATING:case R.ROTATING_FREE:S.enabled=!1;break;case R.YDRAGGING:case R.DRAGGING:z.setCursorStyle("move"),B(),S.enabled=!1}}(e)),G=e,T.setRotating(y.isRotating())}function J(e){let t=function(e){let t=new n.Vector2;return t.x=(e.x-z.widthMargin)/(window.innerWidth-z.widthMargin)*2-1,t.y=-(e.y-z.heightMargin)/(window.innerHeight-z.heightMargin)*2+1,t}(e),i=new n.Vector3(t.x,t.y,.5);return i.unproject(x),i}function Z(e,t){let i=t.customIntersectionPlanes(),n=null;return i&&i.length>0?n=K(e,i,!1):G===R.YDRAGGING?(E.rotation.y=t.rotation.y,E.position.x=t.position.x,E.position.z=t.position.z,n=K(e,E)):n=K(e,b),n.length>0?n[0]:null}function K(e,t,i,o,r,l){let a=J(e);o=o||!1,i=i||!1,r=r||!1,l=l||20;let h,c=a.sub(x.position).normalize(),d=new n.Raycaster;return d.set(x.position,c),d.linePrecision=l,h=t instanceof Array?d.intersectObjects(t,r):d.intersectObject(t,r),o&&(h=s.default.removeIf(h,function(e){return!e.object.visible})),i&&(h=s.default.removeIf(h,function(e){return e.face.normal.dot(c)>0})),h}function Q(){null!=k?null!=_?_!==k&&(_.mouseOff(),(_=k).mouseOver(),y.needsUpdate=!0):((_=k).mouseOver(),z.setCursorStyle("pointer"),y.needsUpdate=!0):null!=_&&(_.mouseOff(),z.setCursorStyle("auto"),_=null,y.needsUpdate=!0)}this.isRotating=function(){return G===R.ROTATING||G===R.ROTATING_FREE},this.selectedObject=function(){return C},this.setSelectedObject=function(e){G===R.UNSELECTED&&q(R.SELECTED),null!=C&&C.setUnselected(),null!=e?((C=e).setSelected(),z.itemSelectedCallbacks.fire(e)):(C=null,z.itemUnselectedCallbacks.fire()),U=!0},this.changeToView=(()=>(this.setSelectedObject(null),this.enabled=!this.enabled,this.enabled)),this.updateInWallItemVisibility=function(e){let t=this.scene.getItems();for(let i=0,s=t.length;i<s;i++)t[i]instanceof a.default&&t[i].updateEdgeVisibility(!e),t[i]instanceof n.Sprite&&this.scene.remove(t[i])},this.getSelectedObject=(()=>C),this.removeObjectFromScene=(e=>{e===C&&(this.scene.removeItem(e),T.resetSelectedItem(),O.resetSelectedItem())}),this.findCabinet=(e=>{let t=this.scene.getItems();for(let e=0,i=t.length;e<i;e++)if(t[e]instanceof h.default&&0===t[e].name.indexOf("emptyCabinet"))return t[e];return null}),this.addIdentification=function(e,t){if(L)y.scene.removeItemsByName(e+"_alarm");else{let i=this.findCabinet(e),o={name:e+"_alarm",size:{x:32,y:32},position:{x:0,y:120,z:0},imgurl:"alarm_tip.png"};void 0!==t&&(o=Object.assign({},o,t));let r=(new n.TextureLoader).load(c.default.getResourceDir()+o.imgurl),l=new n.SpriteMaterial({map:r,color:16711680}),a=new n.Sprite(l);a.name=o.name,a.position.x=i.position.x+o.position.x,a.position.y=i.position.y+o.position.y,a.position.z=i.position.z+o.position.z,s.default.hasObj(o.size)?a.scale.set(o.size.x,o.size.y,1):a.scale.set(1,1,1),y.scene.add(a)}L=!L,y.needsUpdate=!0},this.changeOneCabinet=function(e){let t=["ce1c3fc6-841e-11e8-adc0-fa7ae01bbebc"];for(let i=0,n=e.children.length;i<n;i++){-1!==t.findIndex(function(t){return t===e.children[i].uuid})&&s.default.setSkinColor(e.children[i],16711680)}},this.changeAllAlarmEquipment=function(){let e=this.scene.getItems();for(let t=0,i=e.length;t<i;t++)e[t]instanceof h.default&&0===e[t].name.indexOf("emptyCabinet")&&e[t].children.length>0&&y.changeOneCabinet(e[t])},this.showCabinetUsage=function(e){let t,i,n,s,o,r,l,a,c,u=this.scene.getItems(),f=[16296870,16426837,7906133,4569468,8370190,14236233],p=d.default.emptyCabinet;if(W)this.scene.removeItemsByName("space5401"),this.model.resetCabinetData();else for(let d=u.length-1;d>=0;d--)if(u[d]instanceof h.default&&0===u[d].name.indexOf("emptyCabinet")){let h=u[d];if(e!==u[d].uuid){let e=Math.floor(6*Math.random());t=p.width,i=p.height,n=p.length,s=h.position.x,o=h.position.y,r=h.position.z;let m={name:"space5401",transparent:!0,opacity:.8,blending:!1,wireframe:!1,tween:0,color:f[e],size:{l:n,w:t,h:i},position:{x:l=s,y:a=o,z:c=r},rotation:{x:0,y:0,z:0}};y.addBox(m),u[d].removeSelf()}else y.addChildBox("space5401",f,p,u[d],()=>{u[d].removeSelf()})}y.scene.needsUpdate=!0,W=!W},this.showCabinetSpace=function(){let e,t,i,n,s,o,r,l,a,c=[16296870,16426837,7906133,4569468,8370190,14236233],u=this.scene.getItems(),f=d.default.emptyCabinet;if(V)this.scene.removeItemsByName("space4401"),this.model.resetCabinetData();else for(let d=u.length-1;d>=0;d--)if(u[d]instanceof h.default&&0===u[d].name.indexOf("emptyCabinet")){let h=u[d];e=f.width,t=f.height,i=f.length,n=h.position.x,s=h.position.y,o=h.position.z;let p={name:"space4401",transparent:!1,opacity:.8,blending:!1,wireframe:!0,tween:0,color:16777215,size:{l:i,w:e,h:t},position:{x:r=n,y:l=s,z:a=o},rotation:{x:0,y:0,z:0}};y.addBox(p);let m=196*Math.random()+5,g={name:"space4401",transparent:!1,opacity:.8,blending:!1,wireframe:!1,tween:2500,color:c[Math.floor(6*Math.random())],size:{l:i-.5,w:e-.5,h:m},position:{x:r,y:1,z:a},rotation:{x:0,y:0,z:0}};y.addBox(g),u[d].removeSelf()}y.scene.needsUpdate=!0,V=!V},this.addChildBox=function(e,t,i,n,s){let o=i.width,r=i.length,l=n.position.x,a=(n.position.y,n.position.z),h={name:e,transparent:!1,opacity:.8,blending:!1,wireframe:!1,tween:0,color:14540253,size:{l:r,w:o,h:18},position:{x:l,y:100,z:a},rotation:{x:0,y:0,z:0}};y.addBox(h),h={name:e,transparent:!1,opacity:.8,blending:!1,wireframe:!1,tween:0,color:14540253,size:{l:r,w:o,h:18},position:{x:l,y:120,z:a},rotation:{x:0,y:0,z:0}},y.addBox(h),h={name:e,transparent:!1,opacity:.8,blending:!1,wireframe:!1,tween:0,color:14540253,size:{l:r,w:o,h:28},position:{x:l,y:145,z:a},rotation:{x:0,y:0,z:0}},y.addBox(h),h={name:e,transparent:!1,opacity:.8,blending:!1,wireframe:!1,tween:0,color:14540253,size:{l:r,w:o,h:18},position:{x:l,y:170,z:a},rotation:{x:0,y:0,z:0}},y.addBox(h),h={name:e,transparent:!1,opacity:.8,blending:!1,wireframe:!1,tween:0,color:14540253,size:{l:r,w:o,h:18},position:{x:l,y:80,z:a},rotation:{x:0,y:0,z:0}},y.addBox(h),h={name:e,transparent:!1,opacity:.8,blending:!1,wireframe:!1,tween:0,color:14540253,size:{l:r,w:o,h:18},position:{x:l,y:60,z:a},rotation:{x:0,y:0,z:0}},y.addBox(h),h={name:e,transparent:!1,opacity:.8,blending:!1,wireframe:!1,tween:0,color:14540253,size:{l:r,w:o,h:18},position:{x:l,y:40,z:a},rotation:{x:0,y:0,z:0}},y.addBox(h),h={name:e,transparent:!0,opacity:.8,blending:!1,wireframe:!1,tween:0,color:t[0],size:{l:r,w:o,h:22},position:{x:l,y:193,z:a},rotation:{x:0,y:0,z:0}},y.addBox(h),h={name:e,transparent:!0,opacity:.8,blending:!1,wireframe:!1,tween:0,color:t[1],size:{l:r,w:o,h:26},position:{x:l,y:16,z:a},rotation:{x:0,y:0,z:0}},y.addBox(h),s&&s()},y.addBox=function(e){let t=e.size.h;e.tween>0&&(t=1);let i=new n.BoxGeometry(e.size.w,t,e.size.l),s=new n.Mesh(i,new n.MeshPhongMaterial({color:e.color,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe,shininess:100}));if(s.name=e.name,s.position.set(e.position.x,e.position.y,e.position.z),s.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),!0===e.wireframe){let t=new n.BoxHelper(s,e.color);t.name=e.name,y.scene.add(t)}else y.scene.add(s);if(e.tween>0){let i=e.size,o=t;new u.Tween({h:o}).to({h:i.h},e.tween).onUpdate(function(e){let t=new n.BoxGeometry(i.w,e.h,i.l);s.geometry=t;let r=(e.h-o)/2;s.position.y+=r,o=e.h,y.scene.needsUpdate=!0}).easing(u.Easing.Elastic.Out).start()}},this.init()}},function(e,t){var i,n,s=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(e){i=o}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(e){n=r}}();var a,h=[],c=!1,d=-1;function u(){c&&a&&(c=!1,a.length?h=a.concat(h):d=-1,h.length&&f())}function f(){if(!c){var e=l(u);c=!0;for(var t=h.length;t;){for(a=h,h=[];++d<t;)a&&a[d].run();d=-1,t=h.length}a=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];h.push(new p(e,t)),1!==h.length||c||l(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(28),s=i(29);t.Floorplan=function(e,t,i){let o=this;this.scene=e,this.floorplan=t,this.controls=i,this.floors=[],this.edges=[],t.fireOnUpdatedRooms(function(){o.floors.forEach(e=>{e.removeFromScene()}),o.edges.forEach(e=>{e.remove()}),o.floors=[],o.edges=[],o.floorplan.getRooms().forEach(t=>{let i=new n.Floor(e,t);o.floors.push(i),i.addToScene()}),o.floorplan.wallEdges().forEach(t=>{let i=new s.Edge(e,t,o.controls);o.edges.push(i)})}),this.changeEdgeView=(e=>{for(let t=0;t<this.edges.length;t++)this.edges[t].redraw(e)})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1);t.Floor=function(e,t){let i=this;this.room=t,this.scene=e;let s=null;function o(){i.removeFromScene(),s=r(),i.addToScene()}function r(){let e=i.room.getTexture(),t=(new n.TextureLoader).load(e.url);t.wrapS=n.RepeatWrapping,t.wrapT=n.RepeatWrapping,t.repeat.set(1,1);let s=new n.MeshPhongMaterial({map:t,side:n.DoubleSide,color:13421772,specular:657930,depthTest:!1}),o=e.scale,r=[];i.room.interiorCorners.forEach(e=>{r.push(new n.Vector2(e.x/o,e.y/o))});let l=new n.Shape(r),a=new n.ShapeGeometry(l),h=new n.Mesh(a,s);return h.rotation.set(Math.PI/2,0,0),h.scale.set(o,o,o),h.receiveShadow=!0,h.castShadow=!1,h}i.room.fireOnFloorChange(o),s=r(),this.addToScene=function(){this.scene.add(s),this.scene.add(t.floorPlane)},this.removeFromScene=function(){e.remove(s),e.remove(t.floorPlane)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0);t.Edge=function(e,t,i){let o=this,r=e,l=t,a=i,h=l.wall,c=(l.front,[]),d=[],u=null,f=14540253,p=13421772,m=14540253;function g(){c.forEach(e=>{r.remove(e)}),d.forEach(e=>{r.remove(e)}),c=[],d=[]}function y(){c.forEach(e=>{r.add(e)}),d.forEach(e=>{r.add(e)}),w()}function w(){let e=l.interiorStart(),t=l.interiorEnd(),i=t.x-e.x,s=t.y-e.y,r=new n.Vector3(-s,0,i);r.normalize();let d=a.object.position.clone(),u=new n.Vector3((e.x+t.x)/2,0,(e.y+t.y)/2),f=d.sub(u).normalize(),p=r.dot(f);o.viewFlag?o.visible=!0:o.visible=p>=0,c.forEach(e=>{e.visible=o.visible}),h.items.forEach(e=>{e.updateEdgeVisibility(o.visible)}),h.onItems.forEach(e=>{e.updateEdgeVisibility(o.visible)})}function x(e){e=e||function(){r.needsUpdate=!0};let t=l.getTexture(),i=t.stretch,s=t.url,o=t.scale;if((u=(new n.TextureLoader).load(s,e)).minFilter=n.LinearFilter,!i){let e=h.height,t=l.interiorDistance();u.wrapT=n.RepeatWrapping,u.wrapS=n.RepeatWrapping,u.repeat.set(t/o,e/o),u.needsUpdate=!0}}function v(){let e=new n.MeshLambertMaterial({color:16777215,side:n.FrontSide,map:u}),t=new n.MeshLambertMaterial({color:16777215,side:n.DoubleSide,map:u}),i=new n.MeshBasicMaterial({color:f,side:n.DoubleSide});o.viewFlag&&(e=t,i=t),c.push(b(l.exteriorStart(),l.exteriorEnd(),l.exteriorTransform,l.invExteriorTransform,i)),c.push(b(l.interiorStart(),l.interiorEnd(),l.interiorTransform,l.invInteriorTransform,e)),d.push(M(l,0,n.BackSide,m)),c.push(M(l,h.height,n.DoubleSide,f)),c.push(E(l.interiorStart(),l.exteriorStart(),h.height,p)),c.push(E(l.interiorEnd(),l.exteriorEnd(),h.height,p))}function b(e,t,i,o,r){let l=_(e),a=_(t),c=a.clone();c.y=h.height;let d=l.clone();d.y=h.height;let u=[l.clone(),a.clone(),c.clone(),d.clone()];u.forEach(e=>{e.applyMatrix4(i)});let f=new n.Shape([new n.Vector2(u[0].x,u[0].y),new n.Vector2(u[1].x,u[1].y),new n.Vector2(u[2].x,u[2].y),new n.Vector2(u[3].x,u[3].y)]);h.items.forEach(e=>{let t=e.position.clone();t.applyMatrix4(i);let s=e.halfSize,o=s.clone().multiplyScalar(-1),r=s.clone();o.add(t),r.add(t);let l=[new n.Vector2(o.x,o.y),new n.Vector2(r.x,o.y),new n.Vector2(r.x,r.y),new n.Vector2(o.x,r.y)];f.holes.push(new n.Path(l))});let p=new n.ShapeGeometry(f);p.vertices.forEach(e=>{e.applyMatrix4(o)});let m=s.default.distance(l.x,l.z,a.x,a.z),g=h.height;function y(e){let t=s.default.distance(l.x,l.z,e.x,e.z)/m,i=e.y/g;return new n.Vector2(t,i)}return p.faceVertexUvs[0]=[],p.faces.forEach(e=>{let t=p.vertices[e.a],i=p.vertices[e.b],n=p.vertices[e.c];p.faceVertexUvs[0].push([y(t),y(i),y(n)])}),p.faceVertexUvs[1]=p.faceVertexUvs[0],p.computeFaceNormals(),p.computeVertexNormals(),new n.Mesh(p,r)}function E(e,t,i,s){let o=[_(e),_(t),_(t,i),_(e,i)],r=new n.Geometry;o.forEach(e=>{r.vertices.push(e)}),r.faces.push(new n.Face3(0,1,2)),r.faces.push(new n.Face3(0,2,3));let l=new n.MeshBasicMaterial({color:s,side:n.DoubleSide});return new n.Mesh(r,l)}function M(e,t,i,s){let o=[k(e.exteriorStart()),k(e.exteriorEnd()),k(e.interiorEnd()),k(e.interiorStart())],r=new n.MeshPhongMaterial({side:i,color:s,depthTest:!0}),l=new n.Shape(o),a=new n.ShapeGeometry(l),h=new n.Mesh(a,r);return h.rotation.set(Math.PI/2,0,0),h.position.y=t,h}function k(e){return new n.Vector2(e.x,e.y)}function _(e,t){return t=t||0,new n.Vector3(e.x,t,e.y)}this.visible=!1,this.viewFlag=!1,this.remove=function(){l.redrawCallbacks.remove(o.redraw),a.cameraMovedCallbacks.remove(w),g()},this.redraw=function(e){void 0!==e&&(o.viewFlag=e),g(),x(),v(),y()},l.redrawCallbacks.add(o.redraw),a.cameraMovedCallbacks.add(w),x(),v(),y()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(2);t.Controls=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new n.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1500,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=40,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI/2,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.cameraMovedCallbacks=s.default(),this.needsUpdate=!0;let i=this,o=new n.Vector2,r=new n.Vector2,l=new n.Vector2,a=new n.Vector2,h=new n.Vector2,c=new n.Vector2,d=new n.Vector2,u=new n.Vector2,f=new n.Vector2,p=0,m=0,g=1,y=new n.Vector3,w={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},x=w.NONE;function v(){return 2*Math.PI/60/60*i.autoRotateSpeed}function b(){return Math.pow(.95,i.zoomSpeed)}function E(e){if(!1!==i.enabled){if(e.preventDefault(),0===e.button){if(!0===i.noRotate)return;x=w.ROTATE,o.set(e.clientX,e.clientY)}else if(1===e.button){if(!0===i.noZoom)return;x=w.DOLLY,d.set(e.clientX,e.clientY)}else if(2===e.button){if(!0===i.noPan)return;x=w.PAN,a.set(e.clientX,e.clientY)}i.domElement.addEventListener("mousemove",M,!1),i.domElement.addEventListener("mouseup",k,!1)}}function M(e){if(!1===i.enabled)return;e.preventDefault();let t=i.domElement===document?i.domElement.body:i.domElement;if(x===w.ROTATE){if(!0===i.noRotate)return;r.set(e.clientX,e.clientY),l.subVectors(r,o),i.rotateLeft(2*Math.PI*l.x/t.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*l.y/t.clientHeight*i.rotateSpeed),o.copy(r)}else if(x===w.DOLLY){if(!0===i.noZoom)return;u.set(e.clientX,e.clientY),f.subVectors(u,d),f.y>0?i.dollyIn():i.dollyOut(),d.copy(u)}else if(x===w.PAN){if(!0===i.noPan)return;h.set(e.clientX,e.clientY),c.subVectors(h,a),i.pan(c),a.copy(h)}i.update()}function k(){!1!==i.enabled&&(i.domElement.removeEventListener("mousemove",M,!1),i.domElement.removeEventListener("mouseup",k,!1),x=w.NONE)}function _(e){if(!1===i.enabled||!0===i.noZoom)return;let t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?i.dollyOut():i.dollyIn(),i.update()}function C(e){if(!1!==i.enabled&&!0!==i.noKeys&&!0!==i.noPan)switch(e.keyCode){case i.keys.UP:i.pan(new n.Vector2(0,i.keyPanSpeed));break;case i.keys.BOTTOM:i.pan(new n.Vector2(0,-i.keyPanSpeed));break;case i.keys.LEFT:i.pan(new n.Vector2(i.keyPanSpeed,0));break;case i.keys.RIGHT:i.pan(new n.Vector2(-i.keyPanSpeed,0))}}function S(e){if(!1!==i.enabled)switch(e.touches.length){case 1:if(!0===i.noRotate)return;x=w.TOUCH_ROTATE,o.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===i.noZoom)return;x=w.TOUCH_DOLLY;let t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+n*n);d.set(0,s);break;case 3:if(!0===i.noPan)return;x=w.TOUCH_PAN,a.set(e.touches[0].pageX,e.touches[0].pageY);break;default:x=w.NONE}}function T(e){if(!1===i.enabled)return;e.preventDefault(),e.stopPropagation();let t=i.domElement===document?i.domElement.body:i.domElement;switch(e.touches.length){case 1:if(!0===i.noRotate)return;if(x!==w.TOUCH_ROTATE)return;r.set(e.touches[0].pageX,e.touches[0].pageY),l.subVectors(r,o),i.rotateLeft(2*Math.PI*l.x/t.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*l.y/t.clientHeight*i.rotateSpeed),o.copy(r);break;case 2:if(!0===i.noZoom)return;if(x!==w.TOUCH_DOLLY)return;let n=e.touches[0].pageX-e.touches[1].pageX,s=e.touches[0].pageY-e.touches[1].pageY,p=Math.sqrt(n*n+s*s);u.set(0,p),f.subVectors(u,d),f.y>0?i.dollyOut():i.dollyIn(),d.copy(u);break;case 3:if(!0===i.noPan)return;if(x!==w.TOUCH_PAN)return;h.set(e.touches[0].pageX,e.touches[0].pageY),c.subVectors(h,a),i.pan(c),a.copy(h);break;default:x=w.NONE}}function O(){!1!==i.enabled&&(x=w.NONE)}function z(e){e.preventDefault()}this.controlsActive=function(){return x===w.NONE},this.setPan=function(e){y=e},this.panTo=function(e){let t=new n.Vector3(e.x,i.target.y,e.z),s=i.target.clone().sub(t);y.sub(s),i.update()},this.rotateLeft=function(e){void 0===e&&(e=v()),m-=e},this.rotateUp=function(e){void 0===e&&(e=v()),p-=e},this.panLeft=function(e){let t=new n.Vector3,i=this.object.matrix.elements;t.set(i[0],0,i[2]),t.normalize(),t.multiplyScalar(-e),y.add(t)},this.panUp=function(e){let t=new n.Vector3,i=this.object.matrix.elements;t.set(i[4],0,i[6]),t.normalize(),t.multiplyScalar(e),y.add(t)},this.pan=function(e){let t=i.domElement===document?i.domElement.body:i.domElement;if(void 0!==i.object.fov){let n=i.object.position.clone().sub(i.target).length();n*=Math.tan(i.object.fov/2*Math.PI/180),i.panLeft(2*e.x*n/t.clientHeight),i.panUp(2*e.y*n/t.clientHeight)}else void 0!==i.object.top?(i.panLeft(e.x*(i.object.right-i.object.left)/t.clientWidth),i.panUp(e.y*(i.object.top-i.object.bottom)/t.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.");i.update()},this.panXY=function(e,t){i.pan(new n.Vector2(e,t))},this.dollyIn=function(e){void 0===e&&(e=b()),g/=e},this.dollyOut=function(e){void 0===e&&(e=b()),g*=e},this.update=function(){let e=this.object.position,t=e.clone().sub(this.target),i=Math.atan2(t.x,t.z),n=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(v()),i+=m,n+=p,n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n)),n=Math.max(1e-6,Math.min(Math.PI-1e-6,n));let s=t.length()*g;s=Math.max(this.minDistance,Math.min(this.maxDistance,s)),this.target.add(y),t.x=s*Math.sin(n)*Math.sin(i),t.y=s*Math.cos(n),t.z=s*Math.sin(n)*Math.cos(i),e.copy(this.target).add(t),this.object.lookAt(this.target),m=0,p=0,g=1,y.set(0,0,0),this.cameraMovedCallbacks.fire(),this.needsUpdate=!0},this.addListeners=function(){this.domElement.addEventListener("contextmenu",z,!1),this.domElement.addEventListener("mousedown",E,!1),this.domElement.addEventListener("mousewheel",_,!1),this.domElement.addEventListener("DOMMouseScroll",_,!1),this.domElement.addEventListener("touchstart",S,!1),this.domElement.addEventListener("touchend",O,!1),this.domElement.addEventListener("touchmove",T,!1),window.addEventListener("keydown",C,!1)},this.removeListeners=function(){this.domElement.removeEventListener("contextmenu",z,!1),this.domElement.removeEventListener("mousedown",E,!1),this.domElement.removeEventListener("mousewheel",_,!1),this.domElement.removeEventListener("DOMMouseScroll",_,!1),this.domElement.removeEventListener("touchstart",S,!1),this.domElement.removeEventListener("touchend",O,!1),this.domElement.removeEventListener("touchmove",T,!1),window.removeEventListener("keydown",C,!1)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1);t.Skybox=function(e){let t=e,i=16777215,s=15329769,o=500,r=4e3,l=32,a=15,h=["varying vec3 vWorldPosition;","void main() {","  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","  vWorldPosition = worldPosition.xyz;","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),c=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","varying vec3 vWorldPosition;","void main() {","  float h = normalize( vWorldPosition + offset ).y;","  gl_FragColor = vec4( mix( bottomColor, topColor, (h + 1.0) / 2.0), 1.0 );","}"].join("\n");!function(){let e={topColor:{type:"c",value:new n.Color(i)},bottomColor:{type:"c",value:new n.Color(s)},offset:{type:"f",value:o}},d=new n.SphereGeometry(r,l,a),u=new n.ShaderMaterial({vertexShader:h,fragmentShader:c,uniforms:e,side:n.BackSide}),f=new n.Mesh(d,u);t.add(f)}()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1);t.Lights=function(e,t){let i,s=e,o=t,r=1,l=300;function a(){let e=o.getSize(),t=(Math.max(e.z,e.x)+r)/2,s=o.getCenter(),a=new n.Vector3(s.x,l,s.z);i.position.copy(a),i.target.position.copy(s),i.shadow.camera.left=-t,i.shadow.camera.right=t,i.shadow.camera.top=t,i.shadow.camera.bottom=-t,i.shadowCamera&&(i.shadowCamera.left=i.shadowCameraLeft,i.shadowCamera.right=i.shadowCameraRight,i.shadowCamera.top=i.shadowCameraTop,i.shadowCamera.bottom=i.shadowCameraBottom,i.shadowCamera.updateProjectionMatrix())}this.getDirLight=function(){return i},function(){let e=new n.HemisphereLight(16777215,8947848,1.1);e.position.set(0,l,0),s.add(e),(i=new n.DirectionalLight(16777215,0)).color.setHSL(1,1,.1),i.castShadow=!0,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,i.shadow.camera.far=l+r,i.shadow.bias=-1e-4,i.visible=!0,s.add(i),s.add(i.target),o.fireOnUpdatedRooms(a)}()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(34),o=i(38),r=i(2);t.default=class{constructor(){this.roomLoadingCallbacks=r.default(),this.roomLoadedCallbacks=r.default(),this.roomSavedCallbacks=r.default(),this.roomDeletedCallbacks=r.default(),this.floorplan=new s.default,this.scene=new o.default(this)}resetCabinetData(){JSON.parse(this.storeJsonData).items.forEach(e=>{if("emptyCabinet"===e.ctype){let t=new n.Vector3(e.xpos,e.ypos,e.zpos),i={itemName:e.item_name,ctype:e.ctype,resizable:e.resizable,itemType:e.item_type,modelUrl:e.model_url,itemUuid:e.item_uuid},s=new n.Vector3(e.scale_x,e.scale_y,e.scale_z);this.scene.addItem(e.item_type,e.model_url,i,t,e.rotation,s,e.fixed)}})}loadSerialized(e){this.roomLoadingCallbacks.fire();let t=JSON.parse(e);this.newRoom(t.floorplan,t.items),this.storeJsonData=e,this.roomLoadedCallbacks.fire()}exportSerialized(){let e=[],t=this.scene.getItems();for(let i=0;i<t.length;i++){let n=t[i];e[i]={item_name:n.metadata.itemName,item_type:n.metadata.itemType,item_uuid:n.uuid,ctype:n.metadata.ctype,model_url:n.metadata.modelUrl,xpos:n.position.x,ypos:n.position.y,zpos:n.position.z,rotation:n.rotation.y,scale_x:n.scale.x,scale_y:n.scale.y,scale_z:n.scale.z,fixed:n.fixed}}let i={floorplan:this.floorplan.saveFloorplan(),items:e};return JSON.stringify(i)}newRoom(e,t){this.scene.clearItems(),this.floorplan.loadFloorplan(e),t.forEach(e=>{let t=new n.Vector3(e.xpos,e.ypos,e.zpos),i={itemName:e.item_name,ctype:e.ctype,resizable:e.resizable,itemType:e.item_type,modelUrl:e.model_url,itemUuid:e.item_uuid},s=new n.Vector3(e.scale_x,e.scale_y,e.scale_z);this.scene.addItem(e.item_type,e.model_url,i,t,e.rotation,s,e.fixed)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0),o=i(16),r=i(35),l=i(36),a=i(37),h=i(2),c=10;t.default=class{constructor(){this.roomLoadedCallbacks=h.default(),this.walls=[],this.corners=[],this.rooms=[],this.new_wall_callbacks=h.default(),this.new_corner_callbacks=h.default(),this.redraw_callbacks=h.default(),this.updated_rooms=h.default(),this.floorTextures={}}wallEdges(){let e=[];return this.walls.forEach(t=>{t.frontEdge&&e.push(t.frontEdge),t.backEdge&&e.push(t.backEdge)}),e}wallEdgePlanes(){let e=[];return this.walls.forEach(t=>{t.frontEdge&&e.push(t.frontEdge.plane),t.backEdge&&e.push(t.backEdge.plane)}),e}fireOnNewWall(e){this.new_wall_callbacks.add(e)}fireOnNewCorner(e){this.new_corner_callbacks.add(e)}fireOnRedraw(e){this.redraw_callbacks.add(e)}fireOnUpdatedRooms(e){this.updated_rooms.add(e)}newWall(e,t){let i=new r.default(e,t);return this.walls.push(i),i.fireOnDelete(()=>{this.removeWall(i)}),this.new_wall_callbacks.fire(i),this.update(),i}newCorner(e,t,i){let n=new l.default(this,e,t,i);return this.corners.push(n),n.fireOnDelete(()=>{this.removeCorner(n)}),this.new_corner_callbacks.fire(n),n}getWalls(){return this.walls}getCorners(){return this.corners}getRooms(){return this.rooms}overlappedCorner(e,t,i){i=i||c;for(let n=0;n<this.corners.length;n++)if(this.corners[n].distanceFrom(e,t)<i)return this.corners[n];return null}overlappedWall(e,t,i){i=i||c;for(let n=0;n<this.walls.length;n++)if(this.walls[n].distanceFrom(e,t)<i)return this.walls[n];return null}saveFloorplan(){let e={corners:{},walls:[],wallTextures:[],floorTextures:{},newFloorTextures:{}};return this.corners.forEach(t=>{e.corners[t.id]={x:t.x,y:t.y}}),this.walls.forEach(t=>{e.walls.push({corner1:t.getStart().id,corner2:t.getEnd().id,frontTexture:t.frontTexture,backTexture:t.backTexture})}),e.newFloorTextures=this.floorTextures,e}loadFloorplan(e){this.reset();let t={};if(null!=e&&"corners"in e&&"walls"in e){for(let i in e.corners)if(e.corners.hasOwnProperty(i)){let n=e.corners[i];t[i]=this.newCorner(n.x,n.y,i)}e.walls.forEach(e=>{let i=this.newWall(t[e.corner1],t[e.corner2]);e.frontTexture&&(i.frontTexture=e.frontTexture),e.backTexture&&(i.backTexture=e.backTexture)}),"newFloorTextures"in e&&(this.floorTextures=e.newFloorTextures),this.update(),this.roomLoadedCallbacks.fire()}}getFloorTexture(e){return e in this.floorTextures?this.floorTextures[e]:null}setFloorTexture(e,t,i){this.floorTextures[e]={url:t,scale:i}}update(){this.walls.forEach(e=>{e.resetFrontBack()});let e=this.findRooms(this.corners);this.rooms=[],e.forEach(e=>{this.rooms.push(new a.default(this,e))}),this.assignOrphanEdges(),this.updateFloorTextures(),this.updated_rooms.fire()}getCenter(){return this.getDimensions(!0)}getSize(){return this.getDimensions(!1)}getDimensions(e){e=e||!1;let t,i=1/0,s=-1/0,o=1/0,r=-1/0;return this.corners.forEach(e=>{e.x<i&&(i=e.x),e.x>s&&(s=e.x),e.y<o&&(o=e.y),e.y>r&&(r=e.y)}),t=i===1/0||s===-1/0||o===1/0||r===-1/0?new n.Vector3:e?new n.Vector3(.5*(i+s),0,.5*(o+r)):new n.Vector3(s-i,0,r-o)}findRooms(e){function t(e,t,i){return s.default.angle2pi(e.x-t.x,e.y-t.y,i.x-t.x,i.y-t.y)}let i=[];e.forEach(e=>{e.adjacentCorners().forEach(n=>{i.push(function(e,i){let n=[],s={corner:i,previousCorners:[e]},o={};for(o[e.id]=!0;s;){let r=s.corner;if(o[r.id]=!0,s.corner===e&&r!==i)return s.previousCorners;let l=[],a=s.corner.adjacentCorners();for(let t=0;t<a.length;t++){let n=a[t];n.id in o&&(n!==e||r===i)||l.push(n)}let h=s.previousCorners.slice(0);if(h.push(r),l.length>1){let e=s.previousCorners[s.previousCorners.length-1];l.sort(function(i,n){return t(e,r,n)-t(e,r,i)})}l.length>0&&l.forEach(e=>{n.push({corner:e,previousCorners:h})}),s=n.pop()}return[]}(e,n))})});let n=function(e){let t=[],i={},n=function(e){return e.id};for(let o=0;o<e.length;o++){let r,l=!0,a=e[o];for(let e=0;e<a.length;e++){let t=s.default.cycle(a,e);r=s.default.map(t,n).join("-"),i.hasOwnProperty(r)&&(l=!1)}l&&(t.push(e[o]),i[r]=!0)}return t}(i);return s.default.removeIf(n,s.default.isClockwise)}floorPlanes(){return s.default.map(this.rooms,e=>e.floorPlane)}removeWall(e){s.default.removeValue(this.walls,e),this.update()}updateFloorTextures(){let e=s.default.map(this.rooms,function(e){return e.getUuid()});for(let t in this.floorTextures)s.default.hasValue(e,t)||delete this.floorTextures[t]}reset(){let e=this.corners.slice(0),t=this.walls.slice(0);e.forEach(e=>{e.remove()}),t.forEach(e=>{e.remove()}),this.corners=[],this.walls=[]}assignOrphanEdges(){let e=[];this.walls.forEach(t=>{t.backEdge||t.frontEdge||(t.orphan=!0,new o.default(null,t,!1).generatePlane(),new o.default(null,t,!0).generatePlane(),e.push(t))})}removeCorner(e){s.default.removeValue(this.corners,e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(7),s=i(0),o=i(2),r=i(3);t.default=class{constructor(e,t){this.frontEdge=null,this.backEdge=null,this.orphan=!1,this.items=[],this.onItems=[],this.frontTexture=r.default.getDefaultWallTexture(),this.backTexture=r.default.getDefaultWallTexture(),this.thickness=n.Configuration.getNumericValue(n.configWallThickness),this.height=n.Configuration.getNumericValue(n.configWallHeight),this.moved_callbacks=o.default(),this.deleted_callbacks=o.default(),this.action_callbacks=o.default(),this.start=e,this.end=t,this.id=this.getUuid(),this.start.attachStart(this),this.end.attachEnd(this)}resetFrontBack(){this.frontEdge=null,this.backEdge=null,this.orphan=!1}fireOnMove(e){this.moved_callbacks.add(e)}fireOnDelete(e){this.deleted_callbacks.add(e)}dontFireOnDelete(e){this.deleted_callbacks.remove(e)}fireOnAction(e){this.action_callbacks.add(e)}fireAction(e){this.action_callbacks.fire(e)}fireMoved(){this.moved_callbacks.fire()}fireRedraw(){this.frontEdge&&this.frontEdge.redrawCallbacks.fire(),this.backEdge&&this.backEdge.redrawCallbacks.fire()}getStart(){return this.start}getEnd(){return this.end}getStartX(){return this.start.getX()}getEndX(){return this.end.getX()}getStartY(){return this.start.getY()}getEndY(){return this.end.getY()}remove(){this.start.detachWall(this),this.end.detachWall(this),this.deleted_callbacks.fire(this)}setStart(e){this.start.detachWall(this),e.attachStart(this),this.start=e,this.fireMoved()}setEnd(e){this.end.detachWall(this),e.attachEnd(this),this.end=e,this.fireMoved()}distanceFrom(e,t){return s.default.pointDistanceFromLine(e,t,this.getStartX(),this.getStartY(),this.getEndX(),this.getEndY())}oppositeCorner(e){return this.start===e?this.end:this.end===e?this.start:void console.log("Wall does not connect to corner")}relativeMove(e,t){this.start.relativeMove(e,t),this.end.relativeMove(e,t)}getUuid(){return[this.start.id,this.end.id].join()}snapToAxis(e){this.start.snapToAxis(e),this.end.snapToAxis(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),s=i(2),o=20;t.default=class{constructor(e,t,i,o){this.wallStarts=[],this.wallEnds=[],this.moved_callbacks=s.default(),this.deleted_callbacks=s.default(),this.action_callbacks=s.default(),this.x=t,this.y=i,this.id=o,this.floorplan=e,this.id=o||n.default.guid()}fireOnMove(e){this.moved_callbacks.add(e)}fireOnDelete(e){this.deleted_callbacks.add(e)}fireOnAction(e){this.action_callbacks.add(e)}getX(){return this.x}getY(){return this.y}snapToAxis(e){let t={x:!1,y:!1};return this.adjacentCorners().forEach(i=>{Math.abs(i.x-this.x)<e&&(this.x=i.x,t.x=!0),Math.abs(i.y-this.y)<e&&(this.y=i.y,t.y=!0)}),t}relativeMove(e,t){this.move(this.x+e,this.y+t)}remove(){this.deleted_callbacks.fire(this)}adjacentCorners(){let e=[];for(let t=0;t<this.wallStarts.length;t++)e.push(this.wallStarts[t].getEnd());for(let t=0;t<this.wallEnds.length;t++)e.push(this.wallEnds[t].getStart());return e}distanceFrom(e,t){return n.default.distance(e,t,this.x,this.y)}distanceFromWall(e){return e.distanceFrom(this.x,this.y)}distanceFromCorner(e){return this.distanceFrom(e.x,e.y)}detachWall(e){n.default.removeValue(this.wallStarts,e),n.default.removeValue(this.wallEnds,e),0===this.wallStarts.length&&0===this.wallEnds.length&&this.remove()}attachStart(e){this.wallStarts.push(e)}attachEnd(e){this.wallEnds.push(e)}wallTo(e){for(let t=0;t<this.wallStarts.length;t++)if(this.wallStarts[t].getEnd()===e)return this.wallStarts[t];return null}wallFrom(e){for(let t=0;t<this.wallEnds.length;t++)if(this.wallEnds[t].getStart()===e)return this.wallEnds[t];return null}wallToOrFrom(e){return this.wallTo(e)||this.wallFrom(e)}mergeWithIntersected(){for(let e=0;e<this.floorplan.getCorners().length;e++){let t=this.floorplan.getCorners()[e];if(this.distanceFromCorner(t)<o&&t!==this)return this.combineWithCorner(t),!0}for(let e=0;e<this.floorplan.getWalls().length;e++){let t=this.floorplan.getWalls()[e];if(this.distanceFromWall(t)<o&&!this.isWallConnected(t)){let e=n.default.closestPointOnLine(this.x,this.y,t.getStart().x,t.getStart().y,t.getEnd().x,t.getEnd().y);return this.x=e.x,this.y=e.y,this.floorplan.newWall(this,t.getEnd()),t.setEnd(this),this.floorplan.update(),!0}}return!1}fireAction(e){this.action_callbacks.fire(e)}removeAll(){for(let e=0;e<this.wallStarts.length;e++)this.wallStarts[e].remove();for(let e=0;e<this.wallEnds.length;e++)this.wallEnds[e].remove();this.remove()}move(e,t){this.x=e,this.y=t,this.mergeWithIntersected(),this.moved_callbacks.fire(this.x,this.y),this.wallStarts.forEach(e=>{e.fireMoved()}),this.wallEnds.forEach(e=>{e.fireMoved()})}isWallConnected(e){for(let t=0;t<this.wallStarts.length;t++)if(this.wallStarts[t]===e)return!0;for(let t=0;t<this.wallEnds.length;t++)if(this.wallEnds[t]===e)return!0;return!1}combineWithCorner(e){this.x=e.x,this.y=e.y;for(let t=e.wallStarts.length-1;t>=0;t--)e.wallStarts[t].setStart(this);for(let t=e.wallEnds.length-1;t>=0;t--)e.wallEnds[t].setEnd(this);e.removeAll(),this.removeDuplicateWalls(),this.floorplan.update()}removeDuplicateWalls(){let e={},t={};for(let t=this.wallStarts.length-1;t>=0;t--)this.wallStarts[t].getEnd()===this?this.wallStarts[t].remove():this.wallStarts[t].getEnd().id in e?this.wallStarts[t].remove():e[this.wallStarts[t].getEnd().id]=!0;for(let e=this.wallEnds.length-1;e>=0;e--)this.wallEnds[e].getStart()===this?this.wallEnds[e].remove():this.wallEnds[e].getStart().id in t?this.wallEnds[e].remove():t[this.wallEnds[e].getStart().id]=!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0),o=i(16),r=i(2),l=i(3);t.default=class{constructor(e,t){this.interiorCorners=[],this.floorPlane=null,this.edgePointer=null,this.customTexture=!1,this.floorChangeCallbacks=r.default(),this.floorplan=e,this.corners=t,this.updateWalls(),this.updateInteriorCorners(),this.generatePlane()}fireOnFloorChange(e){this.floorChangeCallbacks.add(e)}getUuid(){let e=s.default.map(this.corners,function(e){return e.id});return e.sort(),e.join()}getTexture(){let e=this.getUuid();return this.floorplan.getFloorTexture(e)||l.default.getDefaultRoomTexture()}setTexture(e,t,i){let n=this.getUuid();this.floorplan.setFloorTexture(n,e,i),this.floorChangeCallbacks.fire()}generatePlane(){let e=[];this.interiorCorners.forEach(t=>{e.push(new n.Vector2(t.x,t.y))});let t=new n.Shape(e),i=new n.ShapeGeometry(t);this.floorPlane=new n.Mesh(i,new n.MeshBasicMaterial({side:n.DoubleSide})),this.floorPlane.rotation.set(Math.PI/2,0,0),this.floorPlane.room=this}cycleIndex(e){return e<0?e+this.corners.length:e%this.corners.length}updateInteriorCorners(){let e=this.edgePointer;for(;this.interiorCorners.push(e.interiorStart()),e.generatePlane(),e.next!==this.edgePointer;)e=e.next}updateWalls(){let e=null,t=null;for(let i=0;i<this.corners.length;i++){let n=this.corners[i],s=this.corners[(i+1)%this.corners.length],r=n.wallTo(s),l=n.wallFrom(s),a=null;r?a=new o.default(this,r,!0):l?a=new o.default(this,l,!1):console.log("corners arent connected by a wall, uh oh"),0===i?t=a:(a.prev=e,e.next=a,i+1===this.corners.length&&(t.prev=a,a.next=t)),e=a}this.edgePointer=t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0),o=i(39),r=i(2);t.default=class{constructor(e){this.needsUpdate=!1,this.items=[],this.itemLoadingCallbacks=r.default(),this.itemLoadedCallbacks=r.default(),this.itemRemovedCallbacks=r.default(),this.model=e,this.scene=new n.Scene,this.loader=new n.JSONLoader,this.loader.crossOrigin=""}add(e){this.scene.add(e)}remove(e){this.scene.remove(e),s.default.removeValue(this.items,e)}getScene(){return this.scene}getItems(){return this.items}getChldren(){return this.scene.children}removeItemsByName(e){let t=this.scene.children;for(let i=t.length-1;i>=0;i--)t[i].name===e&&this.scene.remove(t[i])}itemCount(){return this.items.length}clearItems(){this.items,this.items.forEach(e=>{this.removeItem(e,!0)}),this.items=[]}removeItem(e,t){t=t||!1,this.itemRemovedCallbacks.fire(e),e.removed(),this.scene.remove(e),t||s.default.removeValue(this.items,e)}addCItem(e,t,i,n,r,l,a){let h=null;h="emptyCabinet"===i.ctype?s.default.createGeometryAndMaterials(i):"messagePanel"===i.ctype?s.default.createPlaneGeometry(i):"glasses"===i.ctype||"glassDoor"===i.ctype?s.default.createHole(i):"camera"===i.ctype?s.default.createCamera(i):s.default.createGeometryAndMaterials(i);let c=new(o.default.getClass(e))(this.model,i,n,r,l,h.geometry,h.material);c.fixed=a||!1,this.items.push(c),this.add(c),c.name=i.ctype+s.default.guid(),void 0!==i.itemUuid&&(c.uuid=i.itemUuid),c.initObject(),this.itemLoadedCallbacks.fire(c)}addItem(e,t,i,n,r,l,a){if((e=e||1)<10){let h=(t,h)=>{let c=new(o.default.getClass(e))(this.model,i,t,h[0],n,r,l);c.fixed=a||!1,this.items.push(c),this.add(c),c.name=i.ctype+s.default.guid(),c.initObject(),this.itemLoadedCallbacks.fire(c)};this.itemLoadingCallbacks.fire(),this.loader.load(t,h,void 0)}else this.itemLoadingCallbacks.fire(),this.addCItem(e,t,i,n,r,l,a)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(17),s=i(19),o=i(11),r=i(40),l=i(41),a=i(42),h=i(9),c=i(6),d=i(43),u=i(44),f=i(45),p=i(46),m=i(47),g={1:n.default,2:o.default,3:s.default,7:r.default,8:l.default,9:a.default,10:h.default,11:c.default,12:d.default,13:u.default,14:f.default,15:p.default,16:m.default};t.default=class{static getClass(e){return g[e]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(19);t.default=class extends n.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r),this.boundToFloor=!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(17);t.default=class extends n.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r),this.obstructFloorMoves=!1,this.receiveShadow=!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(11);t.default=class extends n.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r),this.boundToFloor=!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0),o=i(10);t.default=class extends o.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r),this.addDoor()}updateHighlight(){let e=this.hover||this.selected;this.highlighted=e;let t=e?this.emissiveColor:0;for(let e=0;e<this.children.length;e++){let i=this.children[e].material;if(i instanceof Array)for(let e=0;e<i.length;e++)i[e].emissive.setHex(t);else if((i=this.children[e].children[0].material)instanceof Array)for(let e=0;e<i.length;e++)i[e].emissive.setHex(t)}}placeInRoom(){let e=this.closestWallEdge();if(this.changeWallEdge(e),this.updateSize(),!this.position_set){let t=e.interiorCenter(),i=new n.Vector3(t.x,0,t.y);this.boundMove(i),this.position.copy(i),this.redrawWall()}}addDoor(){let e={name:"doorLeft_customGlass_"+s.default.guid(),uuid:"",length:104,height:210,width:4,x:52,style:{skin:{opacity:.1,skin_up:{skinColor:5325886},skin_down:{skinColor:5325886},skin_fore:{skinColor:5325886},skin_behind:{skinColor:5325886},skin_left:{skinColor:5325886,imgurl:"door_left.png",envMap:!0},skin_right:{skinColor:5325886,imgurl:"door_right.png",envMap:!0}}}},t={name:"doorRight_customGlass_"+s.default.guid(),uuid:"",length:104,height:210,width:4,x:-52,style:{skin:{opacity:.1,skin_up:{skinColor:5325886},skin_down:{skinColor:5325886},skin_fore:{skinColor:5325886},skin_behind:{skinColor:5325886},skin_left:{skinColor:5325886,imgurl:"door_right.png",envMap:!0},skin_right:{skinColor:5325886,imgurl:"door_left.png",envMap:!0}}}},i=s.default.createCube(e);this.add(i);let n=s.default.createCube(t);this.add(n)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(6),o=i(0),r=i(14),l=i(3);t.default=class extends s.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r),this.assembleCamera(),this.allowRotate=!1}updateHighlight(){let e=this.hover||this.selected;this.highlighted=e;let t=e?this.emissiveColor:0;for(let e=0;e<this.children.length;e++){let i=this.children[e].material;if(i instanceof Array)for(let e=0;e<i.length;e++)i[e].emissive.setHex(t);else i.emissive.setHex(t)}}placeInRoom(){let e=this.closestWallEdge();if(this.changeWallEdge(e),this.updateSize(),!this.position_set){let t=e.interiorCenter(),i=new n.Vector3(t.x,e.wall.height-5,t.y);this.boundMove(i),this.position.copy(i),this.redrawWall()}}assembleCamera(){let e=new n.MeshPhongMaterial({color:3026478,shininess:50,specular:3026478}),t=new n.CylinderGeometry(6,6,20,200),i=new n.Mesh(t),s=new n.BoxGeometry(10,20,10),a=new n.Mesh(s),h=new n.CylinderGeometry(4,4,20,200),c=new n.Mesh(h),d=o.default.mergeModel("+",i,a),u=new r.default(c);d=new r.default(d).subtract(u).toMesh(e);let f=new n.CylinderGeometry(4,4,15,200),p=new n.Mesh(f);d=o.default.mergeModel("+",d,p);let m=new n.CircleBufferGeometry(4,32),g=(new n.TextureLoader).load(l.default.getResourceDir()+"camera.png");g.minFilter=n.LinearFilter;let y=(new n.TextureLoader).load(l.default.getResourceDir()+"camera_back.png");y.minFilter=n.LinearFilter;let w=new n.MeshPhongMaterial({map:y,side:n.DoubleSide}),x=new n.MeshPhongMaterial({map:g,side:n.DoubleSide}),v=new n.Mesh(m,w);v.position.x=0,v.position.y=8,v.position.z=0,v.rotation.x=-Math.PI/2;let b=new n.Mesh(m,x);b.position.x=0,b.position.y=-8,b.position.z=0,b.rotation.x=-Math.PI/2,d.add(v),d.add(b);let E=[];[{x:0,y:0,z:0},{x:0,y:-10,z:0},{x:0,y:-11,z:-1},{x:0,y:-12,z:-13},{x:0,y:-12,z:-30}].forEach(function(e,t){let i=new n.Vector3(0,0,0);i.x=e.x,i.y=e.y,i.z=e.z,E.push(i)});let M=new n.CatmullRomCurve3(E),k=new n.TubeGeometry(M,20,2,8,!1),_=new n.MeshPhongMaterial({color:3026478,side:n.DoubleSide,reflectivity:1}),C=new n.Mesh(k,_);C.rotation.x=Math.PI/2,d.add(C),d.rotation.x=-Math.PI/2+Math.PI/15,d.position.z=21,d.name="gleye_"+o.default.guid(),this.add(d)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),s=i(10),o=i(4);t.default=class extends s.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r),this.addGlass()}updateHighlight(){let e=this.hover||this.selected;this.highlighted=e;let t=e?this.emissiveColor:0;for(let e=0;e<this.children.length;e++)this.children[e].material.emissive.setHex(t);this.materials.emissive.setHex(t)}addGlass(){let e=this.metadata.ctype,t=o.default[e],i={show:!0,uuid:"",objType:"glasses",width:t.length,height:t.height,pic:"glass.png",transparent:!0,opacity:1,rotation:{x:0,y:0*Math.PI,z:0},blending:!1},s=n.default.createPlaneGeometryObj(i);s.name="windowGlass_customGlass_"+n.default.guid(),this.add(s),i.rotation.y=Math.PI+i.rotation.y;let r=n.default.createPlaneGeometryObj(i);r.name="windowGlass_customGlass_"+n.default.guid(),this.add(r)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),s=i(9),o=i(4);t.default=class extends s.default{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s,o,r);let l=this.model.floorplan.getCenter();this.geometry.computeBoundingBox();let a={x:l.x,y:.5*(this.geometry.boundingBox.max.y-this.geometry.boundingBox.min.y),z:l.z};this.createEmptyCabinet(a)}updateHighlight(){let e=this.hover||this.selected;this.highlighted=e;let t=e?this.emissiveColor:0;for(let e=0;e<this.children.length;e++){let i=this.children[e].material;if(i instanceof Array)for(let e=0;e<i.length;e++)i[e].emissive.setHex(t);else if((i=this.children[e].children[0].material)instanceof Array)for(let e=0;e<i.length;e++)i[e].emissive.setHex(t)}}createEmptyCabinet(e){let t=this.metadata.ctype,i=o.default[t].length,s=o.default[t].height,r=o.default[t].width,l=o.default[t].style,a=o.default[t].thick,h={show:!0,objType:"cube",length:i+1,width:r,height:a+1,x:0,y:e.y,z:0,style:{skinColor:l.skin.skinColor,skin:l.skin.skin_up.skin}},c=n.default.createCube(h),d={show:!0,objType:"cube",length:i,width:a,height:s,x:0,y:-(s/2-a/2),z:0-(r/2-a/2)-1,style:{skinColor:l.skin.skinColor,skin:l.skin.skin_left.skin}},u=n.default.createCube(d),f=n.default.mergeModel("+",c,u),p={show:!0,objType:"cube",length:i,width:a,height:s,x:0,y:-(s/2-a/2),z:r/2-a/2+1,style:{skinColor:l.skin.skinColor,skin:l.skin.skin_right.skin}},m=n.default.createCube(p);f=n.default.mergeModel("+",f,m);let g={show:!0,objType:"cube",length:a,width:r,height:s,x:i/2-a/2+1,y:-(s/2-a/2),z:0,style:{skinColor:l.skin.skinColor,skin:l.skin.skin_behind.skin}},y=n.default.createCube(g);f=n.default.mergeModel("+",f,y);let w={show:!0,uuid:"",name:"",objType:"cube",length:i+1,width:r,height:a,x:-1,y:-(s-a)-1,z:0,style:{skinColor:l.skin.skinColor,skin:l.skin.skin_down.skin}},x=n.default.createCube(w);if((f=n.default.mergeModel("+",f,x)).name="cabinet_shell_"+n.default.guid(),this.add(f),null!=o.default[t].doors&&void 0!==o.default[t].doors){let e=o.default[t].doors;if(1===e.skins.length){let t={show:!0,uuid:"",name:"cabinet_door_"+n.default.guid(),objType:"cube",length:a,width:r,height:s,x:-r/2+a,y:0,z:0,style:{skinColor:e.skins[0].skinColor,skin:e.skins[0]}},i=n.default.createCube(t);this.add(i)}else e.skins.length}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1),s=i(0),o=i(5),r=i(7);t.default=class extends o.default{constructor(e,t,i,s,o,r,l){super(e,t,i,s,o,r,l),this.refVec=new n.Vector2(0,1),this.allowYDrag=!0}moveToPosition(e,t,i){if(this.isValidPosition(e)){if(this.hideError(),i){e.z=this.position.z,e.x=this.position.x,e.y=e.y-2*this.halfSize.y;let t=r.Configuration.getNumericValue(r.configWallHeight);e.y<this.halfSize.y&&(e.y=this.halfSize.y),e.y>t-this.halfSize.y&&(e.y=t-this.halfSize.y)}else e.y=this.position.y;this.position.copy(e)}else this.showError(e)}placeInRoom(){let e=this.closestWallEdge();if(this.changeWallEdge(e),!this.position_set){let t=e.interiorCenter(),i=new n.Vector3(t.x-this.halfSize.x/2,e.wall.height/2,t.y);this.position.copy(i)}}closestWallEdge(){let e=this.model.floorplan.wallEdges(),t=null,i=null,n=this.position.x,s=this.position.z;return e.forEach(e=>{let o=e.distanceTo(n,s);(null===i||o<i)&&(i=o,t=e)}),t}isValidPosition(e){let t=this.getCorners("x","z",e),i=this.model.floorplan.getRooms(),n=!1;for(let e=0;e<i.length;e++)s.default.polygonPolygonIntersect(t,i[e].interiorCorners)||(n=!0);return!!n}resized(){return null}changeWallEdge(e){let t=new n.Vector2,i=e.plane.geometry.faces[0].normal;t.x=i.x,t.y=i.z;let o=s.default.angle(this.refVec.x,this.refVec.y,t.x,t.y);this.rotation.y=o}}}])});